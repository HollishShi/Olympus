var olympus;(function(olympus){function trimURL(url){url=url.replace(/([^:\/])(\/)+/g,"$1/");if(url.charAt(0)=="/")url=url.substr(1);var index;while((index=url.indexOf("/./"))>=0){url=url.replace("/./","/")}var reg=/\/[^\/\.]+?\/\.\.\//;while(reg.test(url)){url=url.replace(reg,"/")}return url}function getHostAndPathname(url){if(url==null)throw new Error("url不能为空");url=url.split("#")[0].split("?")[0];url=trimURL(url);return url}function getPath(url){url=getHostAndPathname(url);var urlArr=url.split("/");urlArr.pop();return urlArr.join("/")+"/"}function isAbsolutePath(url){if(url==null)return false;return url.indexOf("://")>=0}function validateProtocol(url){if(url==null)return null;var index=url.indexOf("://");if(index<0)return url;var protocol=url.substring(0,index);if(protocol=="http"||protocol=="https"){return window.location.protocol+url.substr(index+1)}if(protocol=="ws"||protocol=="wss"){if(window.location.protocol=="https:")protocol="wss";else protocol="ws";return protocol+url.substr(index)}return url}function wrapHost(url,host,forced){if(forced===void 0){forced=false}host=host||window.location.origin;var re=/^(?:[^\/]+):\/{2,}(?:[^\/]+)\//;var arr=url.match(re);if(arr&&arr.length>0){if(forced){url=url.substr(arr[0].length);url=host+"/"+url}}else{url=host+"/"+url}url=validateProtocol(url);url=trimURL(url);return url}function wrapAbsolutePath(relativePath,host){var curPath=getPath(window.location.href);var url=trimURL(curPath+"/"+relativePath);if(host!=null){url=wrapHost(url,host,true)}return url}var Version=function(){function Version(){this._hashDict={}}Version.prototype.initialize=function(handler){var _this=this;if(window["__Olympus_Version_hashDict__"]){this._hashDict=window["__Olympus_Version_hashDict__"];handler()}else{var request=null;if(window["XMLHttpRequest"]){request=new XMLHttpRequest}else if(window["ActiveXObject"]){request=new ActiveXObject("Microsoft.XMLHTTP")}request.onreadystatechange=function(evt){var request=evt.target;if(request.readyState==4){if(request.status==200){var fileName=request["fileName"];var responseText=request.responseText;var lines=responseText.split("\n");for(var i in lines){var line=lines[i];var arr=line.split("  ");if(arr.length==2){var key=arr[1].substr(2);var value=arr[0];_this._hashDict[key]=value}}window["__Olympus_Version_hashDict__"]=_this._hashDict}handler()}};request.open("GET","version.cfg?v="+(new Date).getTime(),true);request.send()}};Version.prototype.getHash=function(url){url=trimURL(url);var result=null;for(var path in this._hashDict){if(url.indexOf(path)>=0){result=this._hashDict[path];break}}return result};Version.prototype.wrapHashUrl=function(url){var hash=this.getHash(url);if(hash!=null){url=this.joinVersion(url,hash)}return url};Version.prototype.joinVersion=function(url,version){if(version==null)return url;version=version.replace(/[^0-9a-z]+/gi,"");var reg=/([a-zA-Z]+:\/+[^\/\?#]+\/[^\?#]+)\.([^\?]+)(\?.+)?/;var result=reg.exec(url);if(result!=null){url=result[1]+"-r_"+version+"."+result[2]+(result[3]||"")}return url};Version.prototype.removeVersion=function(url){url=url.replace(/\-r_[a-z0-9]+\./gi,".");return url};return Version}();var version=new Version;function preload(jsFiles,host,callback){if(!host)host=window.location.origin;version.initialize(preloadOne);function preloadOne(){if(jsFiles.length<=0){callback&&callback()}else{var url=jsFiles.shift();if(!isAbsolutePath(url))url=wrapAbsolutePath(url,host);url=version.wrapHashUrl(url);var xhr=window["XMLHttpRequest"]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");xhr.responseType="text";xhr.onreadystatechange=onReadyStateChange;xhr.open("GET",url,true);xhr.setRequestHeader("Cache-Control","public");xhr.send(null)}}function onReadyStateChange(evt){var xhr=evt.target;if(xhr.readyState==4&&xhr.status==200){var script=document.createElement("script");script.innerHTML=xhr.responseText;document.body.appendChild(script);preloadOne()}}}olympus.preload=preload})(olympus||(olympus={}));