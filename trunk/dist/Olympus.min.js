var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r};var __metadata=this&&this.__metadata||function(k,v){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(k,v)};var Reflect;(function(Reflect){"use strict";var hasOwn=Object.prototype.hasOwnProperty;var supportsSymbol=typeof Symbol==="function";var toPrimitiveSymbol=supportsSymbol&&typeof Symbol.toPrimitive!=="undefined"?Symbol.toPrimitive:"@@toPrimitive";var iteratorSymbol=supportsSymbol&&typeof Symbol.iterator!=="undefined"?Symbol.iterator:"@@iterator";var HashMap;(function(HashMap){var supportsCreate=typeof Object.create==="function";var supportsProto={__proto__:[]}instanceof Array;var downLevel=!supportsCreate&&!supportsProto;HashMap.create=supportsCreate?function(){return MakeDictionary(Object.create(null))}:supportsProto?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})};HashMap.has=downLevel?function(map,key){return hasOwn.call(map,key)}:function(map,key){return key in map};HashMap.get=downLevel?function(map,key){return hasOwn.call(map,key)?map[key]:undefined}:function(map,key){return map[key]}})(HashMap||(HashMap={}));var functionPrototype=Object.getPrototypeOf(Function);var usePolyfill=typeof process==="object"&&process.env&&process.env["REFLECT_METADATA_USE_MAP_POLYFILL"]==="true";var _Map=!usePolyfill&&typeof Map==="function"&&typeof Map.prototype.entries==="function"?Map:CreateMapPolyfill();var _Set=!usePolyfill&&typeof Set==="function"&&typeof Set.prototype.entries==="function"?Set:CreateSetPolyfill();var _WeakMap=!usePolyfill&&typeof WeakMap==="function"?WeakMap:CreateWeakMapPolyfill();var Metadata=new _WeakMap;function decorate(decorators,target,propertyKey,attributes){if(!IsUndefined(propertyKey)){if(!IsArray(decorators))throw new TypeError;if(!IsObject(target))throw new TypeError;if(!IsObject(attributes)&&!IsUndefined(attributes)&&!IsNull(attributes))throw new TypeError;if(IsNull(attributes))attributes=undefined;propertyKey=ToPropertyKey(propertyKey);return DecorateProperty(decorators,target,propertyKey,attributes)}else{if(!IsArray(decorators))throw new TypeError;if(!IsConstructor(target))throw new TypeError;return DecorateConstructor(decorators,target)}}Reflect.decorate=decorate;function metadata(metadataKey,metadataValue){function decorator(target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey)&&!IsPropertyKey(propertyKey))throw new TypeError;OrdinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey)}return decorator}Reflect.metadata=metadata;function defineMetadata(metadataKey,metadataValue,target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey)}Reflect.defineMetadata=defineMetadata;function hasMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryHasMetadata(metadataKey,target,propertyKey)}Reflect.hasMetadata=hasMetadata;function hasOwnMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryHasOwnMetadata(metadataKey,target,propertyKey)}Reflect.hasOwnMetadata=hasOwnMetadata;function getMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryGetMetadata(metadataKey,target,propertyKey)}Reflect.getMetadata=getMetadata;function getOwnMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryGetOwnMetadata(metadataKey,target,propertyKey)}Reflect.getOwnMetadata=getOwnMetadata;function getMetadataKeys(target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryMetadataKeys(target,propertyKey)}Reflect.getMetadataKeys=getMetadataKeys;function getOwnMetadataKeys(target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryOwnMetadataKeys(target,propertyKey)}Reflect.getOwnMetadataKeys=getOwnMetadataKeys;function deleteMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);var metadataMap=GetOrCreateMetadataMap(target,propertyKey,false);if(IsUndefined(metadataMap))return false;if(!metadataMap.delete(metadataKey))return false;if(metadataMap.size>0)return true;var targetMetadata=Metadata.get(target);targetMetadata.delete(propertyKey);if(targetMetadata.size>0)return true;Metadata.delete(target);return true}Reflect.deleteMetadata=deleteMetadata;function DecorateConstructor(decorators,target){for(var i=decorators.length-1;i>=0;--i){var decorator=decorators[i];var decorated=decorator(target);if(!IsUndefined(decorated)&&!IsNull(decorated)){if(!IsConstructor(decorated))throw new TypeError;target=decorated}}return target}function DecorateProperty(decorators,target,propertyKey,descriptor){for(var i=decorators.length-1;i>=0;--i){var decorator=decorators[i];var decorated=decorator(target,propertyKey,descriptor);if(!IsUndefined(decorated)&&!IsNull(decorated)){if(!IsObject(decorated))throw new TypeError;descriptor=decorated}}return descriptor}function GetOrCreateMetadataMap(O,P,Create){var targetMetadata=Metadata.get(O);if(IsUndefined(targetMetadata)){if(!Create)return undefined;targetMetadata=new _Map;Metadata.set(O,targetMetadata)}var metadataMap=targetMetadata.get(P);if(IsUndefined(metadataMap)){if(!Create)return undefined;metadataMap=new _Map;targetMetadata.set(P,metadataMap)}return metadataMap}function OrdinaryHasMetadata(MetadataKey,O,P){var hasOwn=OrdinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn)return true;var parent=OrdinaryGetPrototypeOf(O);if(!IsNull(parent))return OrdinaryHasMetadata(MetadataKey,parent,P);return false}function OrdinaryHasOwnMetadata(MetadataKey,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,false);if(IsUndefined(metadataMap))return false;return ToBoolean(metadataMap.has(MetadataKey))}function OrdinaryGetMetadata(MetadataKey,O,P){var hasOwn=OrdinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn)return OrdinaryGetOwnMetadata(MetadataKey,O,P);var parent=OrdinaryGetPrototypeOf(O);if(!IsNull(parent))return OrdinaryGetMetadata(MetadataKey,parent,P);return undefined}function OrdinaryGetOwnMetadata(MetadataKey,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,false);if(IsUndefined(metadataMap))return undefined;return metadataMap.get(MetadataKey)}function OrdinaryDefineOwnMetadata(MetadataKey,MetadataValue,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,true);metadataMap.set(MetadataKey,MetadataValue)}function OrdinaryMetadataKeys(O,P){var ownKeys=OrdinaryOwnMetadataKeys(O,P);var parent=OrdinaryGetPrototypeOf(O);if(parent===null)return ownKeys;var parentKeys=OrdinaryMetadataKeys(parent,P);if(parentKeys.length<=0)return ownKeys;if(ownKeys.length<=0)return parentKeys;var set=new _Set;var keys=[];for(var _i=0,ownKeys_1=ownKeys;_i<ownKeys_1.length;_i++){var key=ownKeys_1[_i];var hasKey=set.has(key);if(!hasKey){set.add(key);keys.push(key)}}for(var _a=0,parentKeys_1=parentKeys;_a<parentKeys_1.length;_a++){var key=parentKeys_1[_a];var hasKey=set.has(key);if(!hasKey){set.add(key);keys.push(key)}}return keys}function OrdinaryOwnMetadataKeys(O,P){var keys=[];var metadataMap=GetOrCreateMetadataMap(O,P,false);if(IsUndefined(metadataMap))return keys;var keysObj=metadataMap.keys();var iterator=GetIterator(keysObj);var k=0;while(true){var next=IteratorStep(iterator);if(!next){keys.length=k;return keys}var nextValue=IteratorValue(next);try{keys[k]=nextValue}catch(e){try{IteratorClose(iterator)}finally{throw e}}k++}}function Type(x){if(x===null)return 1;switch(typeof x){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return x===null?1:6;default:return 6}}function IsUndefined(x){return x===undefined}function IsNull(x){return x===null}function IsSymbol(x){return typeof x==="symbol"}function IsObject(x){return typeof x==="object"?x!==null:typeof x==="function"}function ToPrimitive(input,PreferredType){switch(Type(input)){case 0:return input;case 1:return input;case 2:return input;case 3:return input;case 4:return input;case 5:return input}var hint=PreferredType===3?"string":PreferredType===5?"number":"default";var exoticToPrim=GetMethod(input,toPrimitiveSymbol);if(exoticToPrim!==undefined){var result=exoticToPrim.call(input,hint);if(IsObject(result))throw new TypeError;return result}return OrdinaryToPrimitive(input,hint==="default"?"number":hint)}function OrdinaryToPrimitive(O,hint){if(hint==="string"){var toString_1=O.toString;if(IsCallable(toString_1)){var result=toString_1.call(O);if(!IsObject(result))return result}var valueOf=O.valueOf;if(IsCallable(valueOf)){var result=valueOf.call(O);if(!IsObject(result))return result}}else{var valueOf=O.valueOf;if(IsCallable(valueOf)){var result=valueOf.call(O);if(!IsObject(result))return result}var toString_2=O.toString;if(IsCallable(toString_2)){var result=toString_2.call(O);if(!IsObject(result))return result}}throw new TypeError}function ToBoolean(argument){return!!argument}function ToString(argument){return""+argument}function ToPropertyKey(argument){var key=ToPrimitive(argument,3);if(IsSymbol(key))return key;return ToString(key)}function IsArray(argument){return Array.isArray?Array.isArray(argument):argument instanceof Object?argument instanceof Array:Object.prototype.toString.call(argument)==="[object Array]"}function IsCallable(argument){return typeof argument==="function"}function IsConstructor(argument){return typeof argument==="function"}function IsPropertyKey(argument){switch(Type(argument)){case 3:return true;case 4:return true;default:return false}}function GetMethod(V,P){var func=V[P];if(func===undefined||func===null)return undefined;if(!IsCallable(func))throw new TypeError;return func}function GetIterator(obj){var method=GetMethod(obj,iteratorSymbol);if(!IsCallable(method))throw new TypeError;var iterator=method.call(obj);if(!IsObject(iterator))throw new TypeError;return iterator}function IteratorValue(iterResult){return iterResult.value}function IteratorStep(iterator){var result=iterator.next();return result.done?false:result}function IteratorClose(iterator){var f=iterator["return"];if(f)f.call(iterator)}function OrdinaryGetPrototypeOf(O){var proto=Object.getPrototypeOf(O);if(typeof O!=="function"||O===functionPrototype)return proto;if(proto!==functionPrototype)return proto;var prototype=O.prototype;var prototypeProto=prototype&&Object.getPrototypeOf(prototype);if(prototypeProto==null||prototypeProto===Object.prototype)return proto;var constructor=prototypeProto.constructor;if(typeof constructor!=="function")return proto;if(constructor===O)return proto;return constructor}function CreateMapPolyfill(){var cacheSentinel={};var arraySentinel=[];var MapIterator=function(){function MapIterator(keys,values,selector){this._index=0;this._keys=keys;this._values=values;this._selector=selector}MapIterator.prototype["@@iterator"]=function(){return this};MapIterator.prototype[iteratorSymbol]=function(){return this};MapIterator.prototype.next=function(){var index=this._index;if(index>=0&&index<this._keys.length){var result=this._selector(this._keys[index],this._values[index]);if(index+1>=this._keys.length){this._index=-1;this._keys=arraySentinel;this._values=arraySentinel}else{this._index++}return{value:result,done:false}}return{value:undefined,done:true}};MapIterator.prototype.throw=function(error){if(this._index>=0){this._index=-1;this._keys=arraySentinel;this._values=arraySentinel}throw error};MapIterator.prototype.return=function(value){if(this._index>=0){this._index=-1;this._keys=arraySentinel;this._values=arraySentinel}return{value:value,done:true}};return MapIterator}();return function(){function Map(){this._keys=[];this._values=[];this._cacheKey=cacheSentinel;this._cacheIndex=-2}Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:true,configurable:true});Map.prototype.has=function(key){return this._find(key,false)>=0};Map.prototype.get=function(key){var index=this._find(key,false);return index>=0?this._values[index]:undefined};Map.prototype.set=function(key,value){var index=this._find(key,true);this._values[index]=value;return this};Map.prototype.delete=function(key){var index=this._find(key,false);if(index>=0){var size=this._keys.length;for(var i=index+1;i<size;i++){this._keys[i-1]=this._keys[i];this._values[i-1]=this._values[i]}this._keys.length--;this._values.length--;if(key===this._cacheKey){this._cacheKey=cacheSentinel;this._cacheIndex=-2}return true}return false};Map.prototype.clear=function(){this._keys.length=0;this._values.length=0;this._cacheKey=cacheSentinel;this._cacheIndex=-2};Map.prototype.keys=function(){return new MapIterator(this._keys,this._values,getKey)};Map.prototype.values=function(){return new MapIterator(this._keys,this._values,getValue)};Map.prototype.entries=function(){return new MapIterator(this._keys,this._values,getEntry)};Map.prototype["@@iterator"]=function(){return this.entries()};Map.prototype[iteratorSymbol]=function(){return this.entries()};Map.prototype._find=function(key,insert){if(this._cacheKey!==key){this._cacheIndex=this._keys.indexOf(this._cacheKey=key)}if(this._cacheIndex<0&&insert){this._cacheIndex=this._keys.length;this._keys.push(key);this._values.push(undefined)}return this._cacheIndex};return Map}();function getKey(key,_){return key}function getValue(_,value){return value}function getEntry(key,value){return[key,value]}}function CreateSetPolyfill(){return function(){function Set(){this._map=new _Map}Object.defineProperty(Set.prototype,"size",{get:function(){return this._map.size},enumerable:true,configurable:true});Set.prototype.has=function(value){return this._map.has(value)};Set.prototype.add=function(value){return this._map.set(value,value),this};Set.prototype.delete=function(value){return this._map.delete(value)};Set.prototype.clear=function(){this._map.clear()};Set.prototype.keys=function(){return this._map.keys()};Set.prototype.values=function(){return this._map.values()};Set.prototype.entries=function(){return this._map.entries()};Set.prototype["@@iterator"]=function(){return this.keys()};Set.prototype[iteratorSymbol]=function(){return this.keys()};return Set}()}function CreateWeakMapPolyfill(){var UUID_SIZE=16;var keys=HashMap.create();var rootKey=CreateUniqueKey();return function(){function WeakMap(){this._key=CreateUniqueKey()}WeakMap.prototype.has=function(target){var table=GetOrCreateWeakMapTable(target,false);return table!==undefined?HashMap.has(table,this._key):false};WeakMap.prototype.get=function(target){var table=GetOrCreateWeakMapTable(target,false);return table!==undefined?HashMap.get(table,this._key):undefined};WeakMap.prototype.set=function(target,value){var table=GetOrCreateWeakMapTable(target,true);table[this._key]=value;return this};WeakMap.prototype.delete=function(target){var table=GetOrCreateWeakMapTable(target,false);return table!==undefined?delete table[this._key]:false};WeakMap.prototype.clear=function(){this._key=CreateUniqueKey()};return WeakMap}();function CreateUniqueKey(){var key;do{key="@@WeakMap@@"+CreateUUID()}while(HashMap.has(keys,key));keys[key]=true;return key}function GetOrCreateWeakMapTable(target,create){if(!hasOwn.call(target,rootKey)){if(!create)return undefined;Object.defineProperty(target,rootKey,{value:HashMap.create()})}return target[rootKey]}function FillRandomBytes(buffer,size){for(var i=0;i<size;++i)buffer[i]=Math.random()*255|0;return buffer}function GenRandomBytes(size){if(typeof Uint8Array==="function"){if(typeof crypto!=="undefined")return crypto.getRandomValues(new Uint8Array(size));if(typeof msCrypto!=="undefined")return msCrypto.getRandomValues(new Uint8Array(size));return FillRandomBytes(new Uint8Array(size),size)}return FillRandomBytes(new Array(size),size)}function CreateUUID(){var data=GenRandomBytes(UUID_SIZE);data[6]=data[6]&79|64;data[8]=data[8]&191|128;var result="";for(var offset=0;offset<UUID_SIZE;++offset){var byte=data[offset];if(offset===4||offset===6||offset===8)result+="-";if(byte<16)result+="0";result+=byte.toString(16).toLowerCase()}return result}}function MakeDictionary(obj){obj.__=undefined;delete obj.__;return obj}(function(__global){if(typeof __global.Reflect!=="undefined"){if(__global.Reflect!==Reflect){for(var p in Reflect){if(hasOwn.call(Reflect,p)){__global.Reflect[p]=Reflect[p]}}}}else{__global.Reflect=Reflect}})(typeof global!=="undefined"?global:typeof self!=="undefined"?self:Function("return this;")())})(Reflect||(Reflect={}));if(Array.prototype.hasOwnProperty("findIndex")){var desc=Object.getOwnPropertyDescriptor(Array.prototype,"findIndex");if(desc.enumerable){desc.enumerable=false;Object.defineProperty(Array.prototype,"findIndex",desc)}}define("utils/ObjectUtil",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function extendObject(target){var sources=[];for(var _i=1;_i<arguments.length;_i++){sources[_i-1]=arguments[_i]}sources.forEach(function(source){if(!source)return;for(var propName in source){if(source.hasOwnProperty(propName)){target[propName]=source[propName]}}});return target}exports.extendObject=extendObject;function cloneObject(target,deep){if(deep===void 0){deep=false}if(target==null)return null;var newObject={};for(var key in target){var value=target[key];if(deep&&typeof value=="object"){value=cloneObject(value,true)}newObject[key]=value}return newObject}exports.cloneObject=cloneObject;function getGUID(){var s=[];var hexDigits="0123456789abcdef";for(var i=0;i<36;i++){s[i]=hexDigits.substr(Math.floor(Math.random()*16),1)}s[14]="4";s[19]=hexDigits.substr(parseInt(s[19])&3|8,1);s[8]=s[13]=s[18]=s[23]="-";return s.join("")}exports.getGUID=getGUID;var _getAutoIncIdMap={};function getAutoIncId(type){var index=_getAutoIncIdMap[type]||0;_getAutoIncIdMap[type]=index++;return type+"-"+index}exports.getAutoIncId=getAutoIncId;function isEmpty(obj){var result=true;for(var key in obj){result=false;break}return result}exports.isEmpty=isEmpty;function trimData(data){for(var key in data){if(data[key]==null){delete data[key]}}return data}exports.trimData=trimData;exports.extendsClass=function(){var extendStatics=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var hash=0;var hashTypes=["object","function"];function getObjectHash(target){if(target==null)return"__object_hash_0__";var key="__object_hash__";var value;if(target.hasOwnProperty(key))value=target[key];if(value)return value;var type=typeof target;if(hashTypes.indexOf(type)<0)return type+":"+target;var value="__object_hash_"+ ++hash+"__";Object.defineProperty(target,key,{configurable:true,enumerable:false,writable:false,value:value});return value}exports.getObjectHash=getObjectHash;function getObjectHashs(){var targets=[];for(var _i=0;_i<arguments.length;_i++){targets[_i]=arguments[_i]}var values=targets.map(function(target){return getObjectHash(target)});return values.join("|")}exports.getObjectHashs=getObjectHashs});define("utils/Dictionary",["require","exports","utils/ObjectUtil"],function(require,exports,ObjectUtil_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Dictionary=function(){function Dictionary(){this._keyDict={};this._valueDict={}}Object.defineProperty(Dictionary.prototype,"size",{get:function(){var size=0;for(var hash in this._keyDict)size++;return size},enumerable:true,configurable:true});Dictionary.prototype.set=function(key,value){var hash=ObjectUtil_1.getObjectHash(key);this._keyDict[hash]=key;this._valueDict[hash]=value};Dictionary.prototype.get=function(key){var hash=ObjectUtil_1.getObjectHash(key);return this._valueDict[hash]};Dictionary.prototype.delete=function(key){var hash=ObjectUtil_1.getObjectHash(key);delete this._keyDict[hash];delete this._valueDict[hash]};Dictionary.prototype.forEach=function(callback){for(var hash in this._keyDict){var key=this._keyDict[hash];var value=this._valueDict[hash];callback(key,value)}};return Dictionary}();exports.default=Dictionary});define("core/interfaces/IConstructor",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("core/command/Command",["require","exports","core/Core"],function(require,exports,Core_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Command=function(){function Command(msg){this.msg=msg}Command.prototype.dispatch=function(typeOrMsg){var params=[];for(var _i=1;_i<arguments.length;_i++){params[_i-1]=arguments[_i]}Core_1.core.dispatch.apply(Core_1.core,[typeOrMsg].concat(params))};return Command}();exports.default=Command});define("core/command/ICommandConstructor",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("core/observable/IObservable",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("core/message/IMessage",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("core/interfaces/IDisposable",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("core/message/Message",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Message=function(){function Message(type){this._type=type}Object.defineProperty(Message.prototype,"type",{get:function(){return this._type},enumerable:true,configurable:true});return Message}();exports.default=Message});define("core/message/CommonMessage",["require","exports","core/message/Message"],function(require,exports,Message_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CommonMessage=function(_super){__extends(CommonMessage,_super);function CommonMessage(type){var params=[];for(var _i=1;_i<arguments.length;_i++){params[_i-1]=arguments[_i]}var _this=_super.call(this,type)||this;_this.params=params;return _this}return CommonMessage}(Message_1.default);exports.default=CommonMessage});define("core/message/CoreMessage",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CoreMessage=function(){function CoreMessage(){}CoreMessage.MESSAGE_DISPATCHED="messageDispatched";return CoreMessage}();exports.default=CoreMessage});define("core/observable/Observable",["require","exports","core/message/CommonMessage","core/message/CoreMessage"],function(require,exports,CommonMessage_1,CoreMessage_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Observable=function(){function Observable(){this._listenerDict={};this._commandDict={};this._disposed=false}Observable.prototype.handleMessages=function(msg){var listeners1=this._listenerDict[msg.type];var listeners2=this._listenerDict[msg.constructor.toString()];var listeners=listeners1&&listeners2?listeners1.concat(listeners2):listeners1||listeners2;if(listeners){listeners=listeners.concat();for(var _i=0,listeners_1=listeners;_i<listeners_1.length;_i++){var temp=listeners_1[_i];if(msg instanceof CommonMessage_1.default)(_a=temp.handler).call.apply(_a,[temp.thisArg].concat(msg.params));else temp.handler.call(temp.thisArg,msg)}}var _a};Observable.prototype.doDispatch=function(msg){Object.defineProperty(msg,"__observable",{configurable:true,enumerable:false,value:this,writable:false});this.handleCommands(msg);this.handleMessages(msg)};Observable.prototype.dispatch=function(typeOrMsg){var params=[];for(var _i=1;_i<arguments.length;_i++){params[_i-1]=arguments[_i]}var msg=typeOrMsg;if(typeof typeOrMsg=="string"){msg=new CommonMessage_1.default(typeOrMsg);msg.params=params}this.doDispatch(msg);this.doDispatch(new CommonMessage_1.default(CoreMessage_1.default.MESSAGE_DISPATCHED,msg))};Observable.prototype.listen=function(type,handler,thisArg){type=typeof type=="string"?type:type.toString();var listeners=this._listenerDict[type];if(!listeners)this._listenerDict[type]=listeners=[];for(var i=0,len=listeners.length;i<len;i++){var temp=listeners[i];if(temp.handler==handler&&temp.thisArg==thisArg)return}listeners.push({handler:handler,thisArg:thisArg})};Observable.prototype.unlisten=function(type,handler,thisArg){type=typeof type=="string"?type:type.toString();var listeners=this._listenerDict[type];if(listeners){for(var i=0,len=listeners.length;i<len;i++){var temp=listeners[i];if(temp.handler==handler&&temp.thisArg==thisArg){listeners.splice(i,1);break}}}};Observable.prototype.handleCommands=function(msg){var commands=this._commandDict[msg.type];if(commands){commands=commands.concat();for(var _i=0,commands_1=commands;_i<commands_1.length;_i++){var cls=commands_1[_i];new cls(msg).exec()}}};Observable.prototype.mapCommand=function(type,cmd){var commands=this._commandDict[type];if(!commands)this._commandDict[type]=commands=[];if(commands.indexOf(cmd)<0)commands.push(cmd)};Observable.prototype.unmapCommand=function(type,cmd){var commands=this._commandDict[type];if(!commands)return;var index=commands.indexOf(cmd);if(index<0)return;commands.splice(index,1)};Object.defineProperty(Observable.prototype,"disposed",{get:function(){return this._disposed},enumerable:true,configurable:true});Observable.prototype.dispose=function(){if(this._disposed)return;this._listenerDict=null;this._commandDict=null;this._disposed=true};return Observable}();exports.default=Observable});define("utils/ConstructUtil",["require","exports","utils/ObjectUtil","utils/Dictionary"],function(require,exports,ObjectUtil_2,Dictionary_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var instanceDict=new Dictionary_1.default;function handleInstance(instance){var cls=instance.constructor;cls=cls["__ori_constructor__"]||cls;var funcs=instanceDict.get(cls);if(funcs)for(var _i=0,funcs_1=funcs;_i<funcs_1.length;_i++){var func=funcs_1[_i];func(instance)}}function wrapConstruct(cls){var func;eval("func = function "+cls["name"]+"(){onConstruct.call(this, arguments)}");ObjectUtil_2.extendsClass(func,cls);func["__ori_constructor__"]=cls;cls["__wrap_constructor__"]=func;return func;function onConstruct(args){this["__proto__"]=cls.prototype;cls.apply(this,args);handleInstance(this)}}exports.wrapConstruct=wrapConstruct;function getConstructor(cls){return cls["__wrap_constructor__"]||cls}exports.getConstructor=getConstructor;function listenConstruct(cls,handler){cls=cls["__ori_constructor__"]||cls;var list=instanceDict.get(cls);if(!list)instanceDict.set(cls,list=[]);if(list.indexOf(handler)<0)list.push(handler)}exports.listenConstruct=listenConstruct;function unlistenConstruct(cls,handler){cls=cls["__ori_constructor__"]||cls;var list=instanceDict.get(cls);if(list){var index=list.indexOf(handler);if(index>=0)list.splice(index,1)}}exports.unlistenConstruct=unlistenConstruct;function listenDispose(cls,handler){var dispose=cls.prototype.dispose;if(dispose){cls.prototype.dispose=function(){handler(this);return dispose.apply(this,arguments)}}}exports.listenDispose=listenDispose});define("core/injector/Injector",["require","exports","core/Core","utils/ConstructUtil","core/message/Message"],function(require,exports,Core_2,ConstructUtil_1,Message_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function Injectable(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(this===undefined){Core_2.core.mapInject(args[0])}else{return function(realCls){for(var _i=0,args_1=args;_i<args_1.length;_i++){var cls=args_1[_i];Core_2.core.mapInject(realCls,cls)}Core_2.core.mapInject(realCls)}}}exports.Injectable=Injectable;function Inject(target,key){if(key){var cls=Reflect.getMetadata("design:type",target,key);doInject(target.constructor,key,cls)}else{return function(prototype,propertyKey){doInject(prototype.constructor,propertyKey,target)}}}exports.Inject=Inject;function doInject(cls,key,type){var target;ConstructUtil_1.listenConstruct(cls,function(instance){Object.defineProperty(instance,key,{configurable:true,enumerable:true,get:function(){return target||(target=Core_2.core.getInject(type))}})})}function MessageHandler(target,key){if(key){var defs=Reflect.getMetadata("design:paramtypes",target,key);var resClass=defs[0];if(!(resClass.prototype instanceof Message_2.default))throw new Error("@MessageHandler装饰器装饰的方法的首个参数必须是Message");doMessageHandler(target.constructor,key,resClass)}else{return function(prototype,propertyKey,descriptor){doMessageHandler(prototype.constructor,propertyKey,target)}}}exports.MessageHandler=MessageHandler;function doMessageHandler(cls,key,type){ConstructUtil_1.listenConstruct(cls,function(instance){Core_2.core.listen(type,instance[key],instance)});ConstructUtil_1.listenDispose(cls,function(instance){Core_2.core.unlisten(type,instance[key],instance)})}});define("core/Core",["require","exports","utils/Dictionary","core/observable/Observable"],function(require,exports,Dictionary_2,Observable_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Core=function(){function Core(){this._observable=new Observable_1.default;this._injectDict=new Dictionary_2.default;this._injectStrDict=new Dictionary_2.default;if(Core._instance)throw new Error("已生成过Core实例，不允许多次生成");Core._instance=this;this.mapInjectValue(this)}Object.defineProperty(Core.prototype,"observable",{get:function(){return this._observable},enumerable:true,configurable:true});Core.prototype.dispatch=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this._observable.dispatch.apply(this._observable,params)};Core.prototype.listen=function(type,handler,thisArg){this._observable.listen(type,handler,thisArg)};Core.prototype.unlisten=function(type,handler,thisArg){this._observable.unlisten(type,handler,thisArg)};Core.prototype.mapCommand=function(type,cmd){this._observable.mapCommand(type,cmd)};Core.prototype.unmapCommand=function(type,cmd){this._observable.unmapCommand(type,cmd)};Core.prototype.mapInject=function(target,type){var oriTarget=target["__ori_constructor__"]||target;var value=this._injectDict.get(oriTarget)||new target;this.mapInjectValue(value,type)};Core.prototype.mapInjectValue=function(value,type){if(!(type instanceof Function)||!type.prototype)type=this._injectStrDict[type]=value.constructor;this._injectDict.set(value.constructor,value);Reflect.defineMetadata("design:type",value,type||value.constructor)};Core.prototype.unmapInject=function(type){if(!(type instanceof Function)||!type.prototype)type=this._injectStrDict[type];Reflect.deleteMetadata("design:type",type)};Core.prototype.getInject=function(type){if(!(type instanceof Function)||!type.prototype)type=this._injectStrDict[type];if(type){type=type["__ori_constructor__"]||type;return Reflect.getMetadata("design:type",type)}};return Core}();exports.default=Core;exports.core=new Core});define("utils/CookieUtil",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function getCookie(name){if(document.cookie.length>0){var start=document.cookie.indexOf(name+"=");if(start!=-1){start=start+name.length+1;var end=document.cookie.indexOf(";",start);if(end==-1)end=document.cookie.length;return decodeURIComponent(document.cookie.substring(start,end))}}return""}exports.getCookie=getCookie;function setCookie(name,value,expire){var exstr="";if(expire!=null){var exdate=new Date;exdate.setMilliseconds(exdate.getMilliseconds()+expire);exstr=";expires="+exdate.toUTCString()}document.cookie=name+"="+encodeURIComponent(value)+exstr}exports.setCookie=setCookie});define("engine/bridge/IHasBridge",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/panel/IPanelPolicy",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("core/interfaces/IOpenClose",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/panel/IPanel",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/panel/IPromptPanel",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ButtonType;(function(ButtonType){ButtonType[ButtonType["normal"]=0]="normal";ButtonType[ButtonType["important"]=1]="important"})(ButtonType=exports.ButtonType||(exports.ButtonType={}))});define("engine/scene/IScene",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/scene/IScenePolicy",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/module/IModuleObservable",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/module/IModuleConstructor",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/module/IModuleDependent",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/mediator/IModuleMediator",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/net/IRequestPolicy",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/net/DataType",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DataType=function(){function DataType(){}DataType.prototype.parse=function(data){this.__rawData=this.doParse(data);return this};return DataType}();exports.default=DataType});define("engine/net/ResponseData",["require","exports","engine/net/DataType"],function(require,exports,DataType_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ResponseData=function(_super){__extends(ResponseData,_super);function ResponseData(){return _super!==null&&_super.apply(this,arguments)||this}return ResponseData}(DataType_1.default);exports.default=ResponseData});define("engine/net/RequestData",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var RequestData=function(){function RequestData(){this.__userData={}}Object.defineProperty(RequestData.prototype,"type",{get:function(){return this.__params.type},enumerable:true,configurable:true});return RequestData}();exports.default=RequestData;exports.commonData={}});define("engine/module/IModule",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/mediator/IMediator",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/mask/IMaskData",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/mask/MaskManager",["require","exports","core/injector/Injector","core/Core","engine/bridge/BridgeManager"],function(require,exports,Injector_1,Core_3,BridgeManager_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var MaskManager=function(){function MaskManager(){this._entityDict={};this._loadingMaskDict={}}MaskManager.prototype.getLoadingMaskCount=function(){var count=0;for(var key in this._loadingMaskDict){var temp=this._loadingMaskDict[key];if(temp>0)count+=temp}return count};MaskManager.prototype.plusLoadingMaskCount=function(key){var count=this._loadingMaskDict[key]||0;if(count<0)count=0;this._loadingMaskDict[key]=++count;return count};MaskManager.prototype.minusLoadingMaskCount=function(key){var count=this._loadingMaskDict[key]||0;count--;if(count<0)count=0;this._loadingMaskDict[key]=count;if(count==0)delete this._loadingMaskDict[key];return count};MaskManager.prototype.registerMask=function(type,entity){this._entityDict[type]=entity};MaskManager.prototype.showMask=function(alpha){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null){entity.maskData.onShowMask&&entity.maskData.onShowMask();entity.showMask(alpha)}};MaskManager.prototype.hideMask=function(){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null){entity.hideMask();entity.maskData.onHideMask&&entity.maskData.onHideMask()}};MaskManager.prototype.isShowingMask=function(){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null)return entity.isShowingMask();return false};MaskManager.prototype.showLoading=function(alpha,key){if(key===void 0){key=null}if(this.getLoadingMaskCount()==0){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null){entity.maskData.onShowLoading&&entity.maskData.onShowLoading(entity.loadingSkin);entity.showLoading(alpha)}}this.plusLoadingMaskCount(key)};MaskManager.prototype.hideLoading=function(key){if(key===void 0){key=null}this.minusLoadingMaskCount(key);if(this.getLoadingMaskCount()==0){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null){entity.hideLoading();entity.maskData.onHideLoading&&entity.maskData.onHideLoading(entity.loadingSkin)}}};MaskManager.prototype.isShowingLoading=function(){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null)return entity.isShowingLoading();return false};MaskManager.prototype.showModalMask=function(popup,alpha){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null){entity.maskData.onShowModalMask&&entity.maskData.onShowModalMask(popup);entity.showModalMask(popup,alpha)}};MaskManager.prototype.hideModalMask=function(popup){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null){entity.hideModalMask(popup);entity.maskData.onHideModalMask&&entity.maskData.onHideModalMask(popup)}};MaskManager.prototype.isShowingModalMask=function(popup){var type=BridgeManager_1.bridgeManager.currentBridge.type;var entity=this._entityDict[type];if(entity!=null)return entity.isShowingModalMask(popup);return false};MaskManager=__decorate([Injector_1.Injectable],MaskManager);return MaskManager}();exports.default=MaskManager;exports.maskManager=Core_3.core.getInject(MaskManager)});define("engine/bridge/IBridge",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/bridge/BridgeMessage",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var BridgeMessage=function(){function BridgeMessage(){}BridgeMessage.BRIDGE_BEFORE_INIT="bridgeBeforeInit";BridgeMessage.BRIDGE_AFTER_INIT="bridgeAfterInit";BridgeMessage.BRIDGE_ALL_INIT="bridgeAllInit";return BridgeMessage}();exports.default=BridgeMessage});define("engine/panel/NonePanelPolicy",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var NonePanelPolicy=function(){function NonePanelPolicy(){}NonePanelPolicy.prototype.pop=function(panel,callback,from){setTimeout(callback,0)};NonePanelPolicy.prototype.drop=function(panel,callback,from){setTimeout(callback,0)};return NonePanelPolicy}();exports.NonePanelPolicy=NonePanelPolicy;exports.default=new NonePanelPolicy});define("engine/panel/PanelMessage",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var PanelMessage=function(){function PanelMessage(){}PanelMessage.PANEL_BEFORE_POP="panelBeforePop";PanelMessage.PANEL_AFTER_POP="panelAfterPop";PanelMessage.PANEL_BEFORE_DROP="panelBeforeDrop";PanelMessage.PANEL_AFTER_DROP="panelAfterDrop";return PanelMessage}();exports.default=PanelMessage});define("engine/system/System",["require","exports","core/Core","core/injector/Injector"],function(require,exports,Core_4,Injector_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var System=function(){function System(){this._nextFrameList=[];this._timer=0;var self=this;if(requestAnimationFrame instanceof Function){requestAnimationFrame(onRequestAnimationFrame)}else{var startTime=Date.now();setInterval(function(){var curTime=Date.now();self._timer=curTime-startTime;self.tick()},1e3/60)}function onRequestAnimationFrame(timer){self._timer=timer;self.tick();requestAnimationFrame(onRequestAnimationFrame)}}System.prototype.getTimer=function(){return this._timer};System.prototype.tick=function(){for(var i=0,len=this._nextFrameList.length;i<len;i++){var data=this._nextFrameList.shift();data[0].apply(data[1],data[2])}};System.prototype.nextFrame=function(handler,thisArg){var _this=this;var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i]}var data=[handler,thisArg,args];this._nextFrameList.push(data);return{cancel:function(){var index=_this._nextFrameList.indexOf(data);if(index>=0)_this._nextFrameList.splice(index,1)}}};System.prototype.enterFrame=function(handler,thisArg){var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i]}var self=this;var cancelable=this.nextFrame.apply(this,[wrapHandler,thisArg].concat(args));return{cancel:function(){cancelable.cancel()}};function wrapHandler(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}handler.apply(this,args);cancelable=self.nextFrame.apply(self,[wrapHandler,this].concat(args))}};System.prototype.setTimeout=function(duration,handler,thisArg){var args=[];for(var _i=3;_i<arguments.length;_i++){args[_i-3]=arguments[_i]}var startTimer=this._timer;var nextFrame=this.nextFrame(tick,this);function tick(){var delta=this._timer-startTimer;if(delta>=duration){nextFrame=null;handler.apply(thisArg,args)}else{nextFrame=this.nextFrame(tick,this)}}return{cancel:function(){nextFrame&&nextFrame.cancel();nextFrame=null}}};System.prototype.setInterval=function(duration,handler,thisArg){var args=[];for(var _i=3;_i<arguments.length;_i++){args[_i-3]=arguments[_i]}var timeout=this.setTimeout(duration,onTimeout,this);function onTimeout(){handler.apply(thisArg,args);timeout=this.setTimeout(duration,onTimeout,this)}return{cancel:function(){timeout&&timeout.cancel();timeout=null}}};System=__decorate([Injector_2.Injectable,__metadata("design:paramtypes",[])],System);return System}();exports.default=System;exports.system=Core_4.core.getInject(System)});define("engine/panel/PanelManager",["require","exports","core/Core","core/injector/Injector","engine/panel/NonePanelPolicy","engine/panel/PanelMessage","engine/panel/IPromptPanel","engine/bridge/BridgeManager","engine/mask/MaskManager","utils/Dictionary"],function(require,exports,Core_5,Injector_3,NonePanelPolicy_1,PanelMessage_1,IPromptPanel_1,BridgeManager_2,MaskManager_1,Dictionary_3){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var PanelManager=function(){function PanelManager(){this._panels=[];this._priorities=new Dictionary_3.default;this._modalDict=new Dictionary_3.default;this._promptDict={}}PanelManager_1=PanelManager;PanelManager.prototype.getOpened=function(cls){if(!cls)return this._panels.concat();else return this._panels.filter(function(panel){return panel.constructor==cls})};PanelManager.prototype.isOpened=function(panel){return this._panels.indexOf(panel)>=0};PanelManager.prototype.updateModalMask=function(panel){MaskManager_1.maskManager.hideModalMask(panel);for(var i=this._panels.length-1;i>=0;i--){panel=this._panels[i];if(this._modalDict.get(panel)){if(MaskManager_1.maskManager.isShowingModalMask(panel))MaskManager_1.maskManager.hideModalMask(panel);MaskManager_1.maskManager.showModalMask(panel);break}}};PanelManager.prototype.pop=function(panel,data,isModal,from){var _this=this;if(isModal===void 0){isModal=true}if(this._panels.indexOf(panel)<0){this._panels.push(panel);panel.bridge.htmlWrapper.style.display="";panel.__open(data,isModal,from);var policy=panel.policy||panel.bridge.defaultPanelPolicy||NonePanelPolicy_1.default;panel.onBeforePop(data,isModal,from);Core_5.core.dispatch(PanelMessage_1.default.PANEL_BEFORE_POP,panel,isModal,from);policy.prepare&&policy.prepare(panel);var bridge=panel.bridge;bridge.addChild(bridge.panelLayer,panel.skin);this._panels.sort(function(a,b){var priA=_this._priorities.get(a)||0;var priB=_this._priorities.get(b)||0;var result=priA-priB;if(result>0){var skinA=a.skin;var skinB=b.skin;var indexA=bridge.getChildIndex(bridge.panelLayer,skinA);var indexB=bridge.getChildIndex(bridge.panelLayer,skinB);bridge.removeChild(bridge.panelLayer,skinA);bridge.removeChild(bridge.panelLayer,skinB);bridge.addChildAt(bridge.panelLayer,skinB,indexA);bridge.addChildAt(bridge.panelLayer,skinA,indexB)}return result});policy.pop(panel,function(){panel.onAfterPop(data,isModal,from);Core_5.core.dispatch(PanelMessage_1.default.PANEL_AFTER_POP,panel,isModal,from)},from);this._modalDict.set(panel,isModal);this.updateModalMask(panel)}return panel};PanelManager.prototype.drop=function(panel,data,to){var index=this._panels.indexOf(panel);if(index>=0){this._panels.splice(index,1);var policy=panel.policy||panel.bridge.defaultPanelPolicy||NonePanelPolicy_1.default;panel.onBeforeDrop(data,to);Core_5.core.dispatch(PanelMessage_1.default.PANEL_BEFORE_DROP,panel,to);policy.drop(panel,function(){panel.onAfterDrop(data,to);Core_5.core.dispatch(PanelMessage_1.default.PANEL_AFTER_DROP,panel,to);var bridge=panel.bridge;var parent=bridge.getParent(panel.skin);if(parent)bridge.removeChild(parent,panel.skin);panel.__close(data,to)},to);this._priorities.delete(panel);this._modalDict.delete(panel);this.updateModalMask(panel)}return panel};PanelManager.prototype.registerPrompt=function(type,prompt){this._promptDict[type]=prompt};PanelManager.prototype.unregisterPrompt=function(type){delete this._promptDict[type]};PanelManager.prototype.prompt=function(msgOrParams){var handlers=[];for(var _i=1;_i<arguments.length;_i++){handlers[_i-1]=arguments[_i]}var params;if(typeof msgOrParams=="string"){params={msg:msgOrParams,handlers:handlers}}else{params=msgOrParams}var curBridge=BridgeManager_2.bridgeManager.currentBridge;var type=curBridge&&curBridge.type;var promptCls=this._promptDict[type];if(promptCls==null){alert(params.msg);return}for(var i in params.handlers){var handler=params.handlers[i];if(handler.text==null)handler.text=handler.data;if(handler.buttonType==null)handler.buttonType=IPromptPanel_1.ButtonType.normal}var prompt=new promptCls;this._priorities.set(prompt,PanelManager_1.PRIORITY_PROMPT);this.pop(prompt);prompt.update(params);return prompt};PanelManager.prototype.alert=function(msgOrParams,okHandler){var params;if(typeof msgOrParams=="string"){params={msg:msgOrParams}}else{params=msgOrParams}params.handlers=[{data:"确定",handler:okHandler,buttonType:IPromptPanel_1.ButtonType.important}];return this.prompt(params)};PanelManager.prototype.confirm=function(msgOrParams,okHandler,cancelHandler){var params;if(typeof msgOrParams=="string"){params={msg:msgOrParams}}else{params=msgOrParams}params.handlers=[{data:"取消",handler:cancelHandler,buttonType:IPromptPanel_1.ButtonType.normal},{data:"确定",handler:okHandler,buttonType:IPromptPanel_1.ButtonType.important}];return this.prompt(params)};PanelManager.PRIORITY_NORMAL=0;PanelManager.PRIORITY_PROMPT=1;PanelManager=PanelManager_1=__decorate([Injector_3.Injectable],PanelManager);return PanelManager;var PanelManager_1}();exports.default=PanelManager;exports.panelManager=Core_5.core.getInject(PanelManager)});define("engine/net/NetMessage",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var NetMessage=function(){function NetMessage(){}NetMessage.NET_REQUEST="netRequest";NetMessage.NET_RESPONSE="netResponse";NetMessage.NET_ERROR="netError";return NetMessage}();exports.default=NetMessage});define("engine/net/NetUtil",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function handleObj(obj){if(obj instanceof Array)return packArray(obj);else if(obj.pack instanceof Function)return obj.pack();else if(typeof obj=="object")return packMap(obj);else obj}function packArray(arr){if(arr==null)return null;var result=arr.map(handleObj);return result}exports.packArray=packArray;function parseArray(arr,cls){if(arr==null)return[];var result=[];for(var i=0,len=arr.length;i<len;i++){var value=arr[i];if(cls==null){result.push(value)}else{result.push((new cls).parse(value))}}return result}exports.parseArray=parseArray;function packMap(map){if(map==null)return null;var result={};for(var key in map){var obj=map[key];result[key]=handleObj(obj)}return result}exports.packMap=packMap;function parseMap(map,cls){if(map==null)return{};var result={};for(var key in map){var value=map[key];if(cls==null){result[key]=value}else{result[key]=(new cls).parse(value)}}return result}exports.parseMap=parseMap});define("engine/net/NetManager",["require","exports","core/Core","core/injector/Injector","core/message/CoreMessage","utils/ObjectUtil","engine/net/RequestData","engine/net/NetMessage","engine/mask/MaskManager"],function(require,exports,Core_6,Injector_4,CoreMessage_2,ObjectUtil_3,RequestData_1,NetMessage_1,MaskManager_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var NetManager=function(){function NetManager(){this._responseDict={};this._responseListeners={};this.listenRequest(Core_6.core)}NetManager.prototype.onMsgDispatched=function(msg){var observable=this;if(msg instanceof RequestData_1.default){MaskManager_2.maskManager.showLoading(null,"net");ObjectUtil_3.extendObject(msg.__params.data,RequestData_1.commonData);msg.__policy.sendRequest(msg);observable.dispatch(NetMessage_1.default.NET_REQUEST,msg)}};NetManager.prototype.listenRequest=function(observable){observable.listen(CoreMessage_2.default.MESSAGE_DISPATCHED,this.onMsgDispatched,observable)};NetManager.prototype.registerResponse=function(cls){this._responseDict[cls.type]=cls};NetManager.prototype.listenResponse=function(clsOrType,handler,thisArg,once,observable){if(once===void 0){once=false}if(!observable)observable=Core_6.core.observable;var type=typeof clsOrType=="string"?clsOrType:clsOrType.type;var listeners=this._responseListeners[type];if(!listeners)this._responseListeners[type]=listeners=[];for(var _i=0,listeners_2=listeners;_i<listeners_2.length;_i++){var listener=listeners_2[_i];if(handler==listener[0]&&thisArg==listener[1]&&once==listener[2])return}listeners.push([handler,thisArg,once,observable])};NetManager.prototype.unlistenResponse=function(clsOrType,handler,thisArg,once,observable){if(once===void 0){once=false}if(!observable)observable=Core_6.core.observable;var type=typeof clsOrType=="string"?clsOrType:clsOrType.type;var listeners=this._responseListeners[type];if(listeners){for(var i=0,len=listeners.length;i<len;i++){var listener=listeners[i];if(handler==listener[0]&&thisArg==listener[1]&&once==listener[2]&&observable==listener[3]){listeners.splice(i,1);break}}}};NetManager.prototype.sendMultiRequests=function(requests,handler,thisArg,observable){var responses=[];var leftResCount=0;if(!observable)observable=Core_6.core.observable;for(var _i=0,_a=requests||[];_i<_a.length;_i++){var request=_a[_i];var response=request.__params.response;if(response){this.listenResponse(response,onResponse,this,true);responses.push(response);leftResCount++}observable.dispatch(request)}testCallback();function onResponse(response){for(var key in responses){var temp=responses[key];if(temp==response.constructor){responses[key]=response;leftResCount--;testCallback();break}}}function testCallback(){if(leftResCount<=0){handler&&handler.call(thisArg,responses)}}};NetManager.prototype.__onResponse=function(type,result,request){MaskManager_2.maskManager.hideLoading("net");var cls=this._responseDict[type];if(cls){var response=new cls;var observable=Core_6.core.observable;if(request){response.__params.request=request;observable=request.__observable}response.parse(result);observable.dispatch(NetMessage_1.default.NET_RESPONSE,response,request);var listeners=this._responseListeners[type];if(listeners){listeners=listeners.concat();for(var _i=0,listeners_3=listeners;_i<listeners_3.length;_i++){var listener=listeners_3[_i];if(listener[3]==observable){listener[0].call(listener[1],response,request);if(listener[2])this.unlistenResponse(type,listener[0],listener[1],listener[2],listener[3])}}}}else{console.warn("没有找到返回结构体定义："+type)}};NetManager.prototype.__onError=function(err,request){MaskManager_2.maskManager.hideLoading("net");var observable=request?request.__observable:Core_6.core;observable.dispatch(NetMessage_1.default.NET_ERROR,err,request)};NetManager=__decorate([Injector_4.Injectable,__metadata("design:paramtypes",[])],NetManager);return NetManager}();exports.default=NetManager;exports.netManager=Core_6.core.getInject(NetManager)});define("engine/module/ModuleMessage",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ModuleMessage=function(){function ModuleMessage(){}ModuleMessage.MODULE_CHANGE="moduleChange";ModuleMessage.MODULE_LOAD_ASSETS_ERROR="moduleLoadAssetsError";return ModuleMessage}();exports.default=ModuleMessage});define("utils/URLUtil",["require","exports","utils/ObjectUtil"],function(require,exports,ObjectUtil_4){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function trimURL(url){url=url.replace(/([^:/])(\/)+/g,"$1/");if(url.charAt(0)=="/")url=url.substr(1);var index;while((index=url.indexOf("/./"))>=0){url=url.replace("/./","/")}var reg=/\/[^\/\.]+?\/\.\.\//;while(reg.test(url)){url=url.replace(reg,"/")}return url}exports.trimURL=trimURL;function isAbsolutePath(url){if(url==null)return false;return url.indexOf("://")>=0}exports.isAbsolutePath=isAbsolutePath;function validateProtocol(url){if(url==null)return null;var index=url.indexOf("://");if(index<0)return url;var protocol=url.substring(0,index);if(protocol=="http"||protocol=="https"){return window.location.protocol+url.substr(index+1)}if(protocol=="ws"||protocol=="wss"){if(window.location.protocol=="https:")protocol="wss";else protocol="ws";return protocol+url.substr(index)}return url}exports.validateProtocol=validateProtocol;function wrapHost(url,host,forced){if(forced===void 0){forced=false}host=host||window.location.origin;var re=/^(?:[^\/]+):\/{2,}(?:[^\/]+)\//;var arr=url.match(re);if(arr&&arr.length>0){if(forced){url=url.substr(arr[0].length);url=host+"/"+url}}else{url=host+"/"+url}url=validateProtocol(url);url=trimURL(url);return url}exports.wrapHost=wrapHost;function wrapAbsolutePath(relativePath,host){var curPath=getPath(window.location.href);var url=trimURL(curPath+"/"+relativePath);if(host!=null){url=wrapHost(url,host,true)}return url}exports.wrapAbsolutePath=wrapAbsolutePath;function getHostAndPathname(url){if(url==null)throw new Error("url不能为空");url=url.split("#")[0].split("?")[0];url=trimURL(url);return url}exports.getHostAndPathname=getHostAndPathname;function getPath(url){url=getHostAndPathname(url);var urlArr=url.split("/");urlArr.pop();return urlArr.join("/")+"/"}exports.getPath=getPath;function getName(url){url=url.split("#")[0].split("?")[0];var urlArr=url.split("/");var fileName=urlArr[urlArr.length-1];return fileName}exports.getName=getName;function parseUrl(url){var regExp=/(([^:]+:)\/\/(([^:\/\?#]+)(:(\d+))?))(\/[^?#]*)?(\?[^#]*)?(#.*)?/;var match=regExp.exec(url);if(match){return{href:match[0]||"",origin:match[1]||"",protocol:match[2]||"",host:match[3]||"",hostname:match[4]||"",port:match[6]||"",pathname:match[7]||"",search:match[8]||"",hash:(match[9]=="#"?"":match[9])||""}}else{throw new Error("传入parseUrl方法的参数不是一个完整的URL："+url)}}exports.parseUrl=parseUrl;function getQueryParams(url){var index=url.indexOf("#");if(index>=0){url=url.substring(0,index)}index=url.indexOf("?");if(index<0)return{};var queryString=url.substring(index+1);var params={};var kvs=queryString.split("&");kvs.forEach(function(kv){var pair=kv.split("=",2);if(pair.length!==2||!pair[0]){console.log("[URLUtil] invalid query params: "+kv);return}var name=decodeURIComponent(pair[0]);var value=decodeURIComponent(pair[1]);params[name]=value});return params}exports.getQueryParams=getQueryParams;function joinQueryParams(url,params){if(url==null)throw new Error("url不能为空");var oriParams=getQueryParams(url);var targetParams=ObjectUtil_4.extendObject(oriParams,params);var hash=parseUrl(url).hash;url=getHostAndPathname(url);var isFirst=true;for(var key in targetParams){if(isFirst){url+="?"+encodeURIComponent(key)+"="+encodeURIComponent(targetParams[key]);isFirst=false}else{url+="&"+encodeURIComponent(key)+"="+encodeURIComponent(targetParams[key])}}url+=hash;return url}exports.joinQueryParams=joinQueryParams;function joinHashParams(url,params){if(url==null)throw new Error("url不能为空");var hash=parseUrl(url).hash;if(hash==null||hash=="")return url;for(var key in params){var value=params[key];if(value&&typeof value!="string")value=value.toString();hash+=(hash.indexOf("?")<0?"?":"&")+encodeURIComponent(key)+"="+encodeURIComponent(value)}return url.split("#")[0]+hash}exports.joinHashParams=joinHashParams});define("engine/env/Environment",["require","exports","core/Core","core/injector/Injector","utils/URLUtil"],function(require,exports,Core_7,Injector_5,URLUtil_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Environment=function(){function Environment(){}Object.defineProperty(Environment.prototype,"env",{get:function(){return this._env},enumerable:true,configurable:true});Object.defineProperty(Environment.prototype,"hostsDict",{get:function(){return this._hostsDict},enumerable:true,configurable:true});Environment.prototype.getHost=function(index){if(index===void 0){index=0}var hosts=this._hostsDict[this._env];if(!hosts)return window.location.origin;return hosts[index]||window.location.origin};Object.defineProperty(Environment.prototype,"cdnsDict",{get:function(){return this._cdnsDict},enumerable:true,configurable:true});Object.defineProperty(Environment.prototype,"curCDNHost",{get:function(){var cdns=this._cdnsDict[this._env];if(!cdns)return window.location.origin;return cdns[this._curCDNIndex]||window.location.origin},enumerable:true,configurable:true});Environment.prototype.nextCDN=function(){var cdns=this._cdnsDict[this._env];if(!cdns)return true;this._curCDNIndex++;if(this._curCDNIndex>=cdns.length){this._curCDNIndex=0;return true}return false};Environment.prototype.initialize=function(env,hostsDict,cdnsDict){this._env=env||"dev";this._hostsDict=hostsDict||{};this._cdnsDict=cdnsDict||{};this._curCDNIndex=0};Environment.prototype.toHostURL=function(url,index){if(index===void 0){index=0}url=URLUtil_1.wrapHost(url,this.getHost(index));return url};Environment.prototype.toCDNHostURL=function(url,forced,infix){if(forced===void 0){forced=false}if(infix===void 0){infix=true}if(infix){var midnameIndex=window.location.pathname.lastIndexOf("/");var midname=window.location.pathname.substring(0,midnameIndex+1);return URLUtil_1.wrapHost(url,this.curCDNHost+"/"+midname,forced)}else{return URLUtil_1.wrapHost(url,this.curCDNHost,forced)}};Environment=__decorate([Injector_5.Injectable],Environment);return Environment}();exports.default=Environment;exports.environment=Core_7.core.getInject(Environment)});define("utils/HTTPUtil",["require","exports","engine/env/Environment","utils/URLUtil","utils/ObjectUtil"],function(require,exports,Environment_1,URLUtil_2,ObjectUtil_5){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function load(params){if(!params.url){params.onResponse&&params.onResponse();return}if(params.url instanceof Array){var urls=params.url;var results=[];var newParams=ObjectUtil_5.cloneObject(params);newParams.onResponse=function(result){results.push(result);loadNext()};var loadNext=function(){if(urls.length<=0){params.onResponse&&params.onResponse(results);return}newParams.url=urls.shift();load(newParams)};loadNext();return}var retryTimes=params.retryTimes||2;var timeout=params.timeout||1e4;var method=params.method||"GET";var timeoutId=0;var data=params.data||{};var url=params.url;if(params.useCDN){url=Environment_1.environment.toCDNHostURL(url)}else{url=URLUtil_2.validateProtocol(url);url=URLUtil_2.trimURL(url)}var xhr=window["XMLHttpRequest"]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(params.responseType)xhr.responseType=params.responseType;xhr.onreadystatechange=onReadyStateChange;send();function send(){var sendData=null;switch(method){case"POST":sendData=JSON.stringify(data);break;case"GET":url=URLUtil_2.joinQueryParams(url,data);break;default:throw new Error("暂不支持的HTTP Method："+method)}xhr.open(method,url,true);for(var key in params.headerDict){xhr.setRequestHeader(key,params.headerDict[key])}xhr.send(sendData)}function onReadyStateChange(){switch(xhr.readyState){case 2:timeoutId=setTimeout(abortAndRetry,timeout);break;case 4:timeoutId&&clearTimeout(timeoutId);timeoutId=0;if(xhr.status==200){params.onResponse&&params.onResponse(xhr.response)}else if(retryTimes>0){abortAndRetry()}else{if(params.useCDN&&!Environment_1.environment.nextCDN()){load(params)}else{var err=new Error(xhr.status+" "+xhr.statusText);params.onError&&params.onError(err)}}break}}function abortAndRetry(){retryTimes--;xhr.abort();url=URLUtil_2.joinQueryParams(url,{_r:Date.now()});send()}}exports.load=load});define("engine/version/Version",["require","exports","core/Core","core/injector/Injector","utils/URLUtil"],function(require,exports,Core_8,Injector_6,URLUtil_3){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Version=function(){function Version(){this._hashDict={}}Version.prototype.initialize=function(handler){var _this=this;if(window["__Olympus_Version_hashDict__"]){this._hashDict=window["__Olympus_Version_hashDict__"];handler()}else{var request=null;if(window["XMLHttpRequest"]){request=new XMLHttpRequest}else if(window["ActiveXObject"]){request=new ActiveXObject("Microsoft.XMLHTTP")}request.onreadystatechange=function(evt){var request=evt.target;if(request.readyState==4){if(request.status==200){var fileName=request["fileName"];var responseText=request.responseText;var lines=responseText.split("\n");for(var i in lines){var line=lines[i];var arr=line.split("  ");if(arr.length==2){var key=arr[1].substr(2);var value=arr[0];_this._hashDict[key]=value}}window["__Olympus_Version_hashDict__"]=_this._hashDict}handler()}};request.open("GET","version.cfg?v="+(new Date).getTime(),true);request.send()}};Version.prototype.getHash=function(url){url=URLUtil_3.trimURL(url);var result=null;for(var path in this._hashDict){if(url.indexOf(path)>=0){result=this._hashDict[path];break}}return result};Version.prototype.wrapHashUrl=function(url){var hash=this.getHash(url);if(hash!=null){url=this.joinVersion(url,hash)}return url};Version.prototype.joinVersion=function(url,version){if(version==null)return url;version=version.replace(/[^0-9a-z]+/gi,"");var reg=/(([a-zA-Z]+:\/+[^\/\?#]+\/)?[^\?#]+)\.([^\?]+)(\?.+)?/;var result=reg.exec(url);if(result!=null){url=result[1]+"-r_"+version+"."+result[3]+(result[4]||"")}return url};Version.prototype.removeVersion=function(url){url=url.replace(/\-r_[a-z0-9]+\./gi,".");return url};Version=__decorate([Injector_6.Injectable],Version);return Version}();exports.default=Version;exports.version=Core_8.core.getInject(Version)});define("engine/assets/AssetsManager",["require","exports","core/injector/Injector","core/Core","utils/HTTPUtil","engine/version/Version"],function(require,exports,Injector_7,Core_9,HTTPUtil_1,Version_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AssetsManager=function(){function AssetsManager(){this._keyDict={};this._assetsDict={}}AssetsManager.prototype.configPath=function(arg1,arg2){if(typeof arg1=="string"){this._keyDict[arg1]=arg2}else{for(var key in arg1){this._keyDict[key]=arg1[key]}}};AssetsManager.prototype.getAssets=function(keyOrPath){var path=this._keyDict[keyOrPath]||keyOrPath;return this._assetsDict[path]};AssetsManager.prototype.loadAssets=function(keyOrPath,complete,responseType){var _this=this;if(!keyOrPath){complete();return}if(keyOrPath instanceof Array){var results=[];var onGetOne=function(result){results.push(result);getOne()};var getOne=function(){if(keyOrPath.length<=0)complete(results);else _this.loadAssets(keyOrPath.shift(),onGetOne)};getOne()}else{var path=this._keyDict[keyOrPath]||keyOrPath;var value=this._assetsDict[path];if(value instanceof Array){value.push(complete)}else if(value){complete(value)}else{this._assetsDict[path]=value=[complete];HTTPUtil_1.load({url:Version_1.version.wrapHashUrl(path),useCDN:true,responseType:responseType,onResponse:function(result){_this._assetsDict[path]=result;for(var _i=0,value_1=value;_i<value_1.length;_i++){var handler=value_1[_i];handler(result)}},onError:function(err){delete _this._assetsDict[path];for(var _i=0,value_2=value;_i<value_2.length;_i++){var handler=value_2[_i];handler(err)}}})}}};AssetsManager=__decorate([Injector_7.Injectable],AssetsManager);return AssetsManager}();exports.default=AssetsManager;exports.assetsManager=Core_9.core.getInject(AssetsManager)});define("engine/env/Shell",["require","exports","core/injector/Injector","core/Core"],function(require,exports,Injector_8,Core_10){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Shell=function(){function Shell(){}Object.defineProperty(Shell.prototype,"type",{get:function(){return"web"},enumerable:true,configurable:true});Shell.prototype.reload=function(params){if(!params)window.location.reload();else if(!params.url)window.location.reload(params.forcedReload);else if(!params.replace)window.location.href=params.url;else window.location.replace(params.url)};Shell.prototype.open=function(params){if(!params){window.open()}else{var features=undefined;if(params.features){features=[];for(var key in params.features){features.push(key+"="+params.features[key])}}window.open(params.url,params.name,features&&features.join(","),params.replace)}};Shell.prototype.close=function(){window.close()};Shell.prototype.localStorageGet=function(key){return window.localStorage.getItem(key)};Shell.prototype.localStorageSet=function(key,value){window.localStorage.setItem(key,value)};Shell.prototype.localStorageRemove=function(key){window.localStorage.removeItem(key)};Shell.prototype.localStorageClear=function(){window.localStorage.clear()};Shell=__decorate([Injector_8.Injectable],Shell);return Shell}();exports.default=Shell;exports.shell=Core_10.core.getInject(Shell)});define("engine/audio/IAudio",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/audio/AudioMessage",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AudioMessage=function(){function AudioMessage(){}AudioMessage.AUDIO_PLAY_STARTED="audioPlayStarted";AudioMessage.AUDIO_PLAY_STOPPED="audioPlayStopped";AudioMessage.AUDIO_PLAY_ENDED="audioPlayEnded";AudioMessage.AUDIO_PLAY_PROGRESS="audioPlayProgress";return AudioMessage}();exports.default=AudioMessage});define("engine/audio/AudioTagImpl",["require","exports","core/Core","engine/audio/AudioMessage","engine/env/Environment"],function(require,exports,Core_11,AudioMessage_1,Environment_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AudioTagImpl=function(){function AudioTagImpl(){this._audioCache={}}AudioTagImpl.prototype.load=function(url){var _this=this;var toUrl=Environment_2.environment.toCDNHostURL(url);var data=this._audioCache[toUrl];if(!data){var node=document.createElement("audio");node.src=toUrl;this._audioCache[toUrl]=data={node:node,status:AudioStatus.LOADING,playParams:null};node.onloadeddata=function(){data.status=AudioStatus.PAUSED;if(data.playParams)_this.play(data.playParams)};node.onended=function(){Core_11.core.dispatch(AudioMessage_1.default.AUDIO_PLAY_ENDED,url)}}};AudioTagImpl.prototype.play=function(params){var toUrl=Environment_2.environment.toCDNHostURL(params.url);var data=this._audioCache[toUrl];if(!data){this.load(params.url);this._audioCache[toUrl].playParams=params}else{switch(data.status){case AudioStatus.LOADING:data.playParams=params;break;case AudioStatus.PLAYING:this.stop(params.url);this.play(params);break;case AudioStatus.PAUSED:if(params.stopOthers)this.stopAll();if(params.loop!=null)data.node.loop=params.loop;if(params.time!=null)data.node.currentTime=params.time*.001;data.node.ontimeupdate=function(evt){if(data.status==AudioStatus.PLAYING){var curTime=data.node.currentTime*1e3;var totalTime=data.node.duration*1e3;Core_11.core.dispatch(AudioMessage_1.default.AUDIO_PLAY_PROGRESS,curTime,totalTime)}};data.node.play();data.status=AudioStatus.PLAYING;Core_11.core.dispatch(AudioMessage_1.default.AUDIO_PLAY_STARTED,params.url);break}}};AudioTagImpl.prototype._doStop=function(url,time){var toUrl=Environment_2.environment.toCDNHostURL(url);var data=this._audioCache[toUrl];if(data){data.node.autoplay=false;data.node.pause();if(time!=null)data.node.currentTime=time*.001;data.status=AudioStatus.PAUSED;Core_11.core.dispatch(AudioMessage_1.default.AUDIO_PLAY_STOPPED,url)}};AudioTagImpl.prototype.pause=function(url){this._doStop(url)};AudioTagImpl.prototype.stop=function(url){this._doStop(url,0)};AudioTagImpl.prototype.stopAll=function(){for(var url in this._audioCache){this.stop(url)}};AudioTagImpl.prototype.seek=function(url,time){var data=this._audioCache[url];if(data)data.node.currentTime=time*.001};return AudioTagImpl}();exports.default=AudioTagImpl;var AudioStatus;(function(AudioStatus){AudioStatus[AudioStatus["LOADING"]=0]="LOADING";AudioStatus[AudioStatus["PAUSED"]=1]="PAUSED";AudioStatus[AudioStatus["PLAYING"]=2]="PLAYING"})(AudioStatus||(AudioStatus={}))});define("engine/audio/AudioContextImpl",["require","exports","engine/assets/AssetsManager","core/Core","engine/audio/AudioMessage","engine/env/Environment","engine/system/System"],function(require,exports,AssetsManager_1,Core_12,AudioMessage_2,Environment_3,System_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AudioContextImpl=function(){function AudioContextImpl(){var _this=this;this._inited=false;this._audioCache={};this._context=new(window["AudioContext"]||window["webkitAudioContext"]);var onInit=function(){window.removeEventListener("touchstart",onInit);window.removeEventListener("mousedown",onInit);var source=_this._context.createBufferSource();source.buffer=_this._context.createBuffer(1,1,44100);source.connect(_this._context.destination);source.start();source.stop();_this._inited=true;for(var url in _this._audioCache){var data=_this._audioCache[url];if(data.status==AudioStatus.PLAYING){_this.stop(data.playParams.url);_this.play(data.playParams)}}};window.addEventListener("touchstart",onInit);window.addEventListener("mousedown",onInit)}AudioContextImpl.prototype.load=function(url){var _this=this;var toUrl=Environment_3.environment.toCDNHostURL(url);var data=this._audioCache[toUrl];if(!data){this._audioCache[toUrl]=data={buffer:null,status:AudioStatus.LOADING,playParams:null,progress:null};AssetsManager_1.assetsManager.loadAssets(toUrl,function(result){if(result instanceof ArrayBuffer){_this._context.decodeAudioData(result,function(buffer){data.buffer=buffer;data.status=AudioStatus.PAUSED;if(data.playParams)_this.play(data.playParams)})}},"arraybuffer")}};AudioContextImpl.prototype.play=function(params){var _this=this;var toUrl=Environment_3.environment.toCDNHostURL(params.url);var data=this._audioCache[toUrl];if(!data){this.load(params.url);this._audioCache[toUrl].playParams=params}else{switch(data.status){case AudioStatus.LOADING:data.playParams=params;break;case AudioStatus.PLAYING:this.stop(params.url);this.play(params);break;case AudioStatus.PAUSED:data.status=AudioStatus.PLAYING;if(this._inited){data.node=this._context.createBufferSource();data.node.buffer=data.buffer;if(params.loop!=null)data.node.loop=params.loop;data.node.connect(this._context.destination);data.node.onended=function(){var data=_this._audioCache[toUrl];if(data){_this.stop(params.url);Core_12.core.dispatch(AudioMessage_2.default.AUDIO_PLAY_ENDED,params.url)}};var playTime;if(params&&params.time!=null)playTime=params.time*.001;else playTime=data.playTime;delete data.playTime;data.node.start(playTime);var lastTime=this._context.currentTime;var curTime=playTime||0;data.progress=System_1.system.enterFrame(function(){var nowTime=_this._context.currentTime;var deltaTime=nowTime-lastTime;lastTime=nowTime;if(data.status==AudioStatus.PLAYING){curTime+=deltaTime*1e3;var totalTime=data.node.buffer.duration*1e3;Core_12.core.dispatch(AudioMessage_2.default.AUDIO_PLAY_PROGRESS,curTime,totalTime)}});Core_12.core.dispatch(AudioMessage_2.default.AUDIO_PLAY_STARTED,params.url)}break}}};AudioContextImpl.prototype._doStop=function(url,time){var toUrl=Environment_3.environment.toCDNHostURL(url);var data=this._audioCache[toUrl];if(data){data.status=AudioStatus.PAUSED;if(data.progress)data.progress.cancel();if(data.node){data.node.stop(time);Core_12.core.dispatch(AudioMessage_2.default.AUDIO_PLAY_STOPPED,url)}}};AudioContextImpl.prototype.pause=function(url){this._doStop(url)};AudioContextImpl.prototype.stop=function(url){this._doStop(url,0)};AudioContextImpl.prototype.stopAll=function(){for(var url in this._audioCache){this.stop(url)}};AudioContextImpl.prototype.seek=function(url,time){var toUrl=Environment_3.environment.toCDNHostURL(url);var data=this._audioCache[toUrl];if(data){var params=data.playParams;if(data.status==AudioStatus.PLAYING){this.stop(url);params.time=time;this.play(params)}else{data.playTime=time}}};return AudioContextImpl}();exports.default=AudioContextImpl;var AudioStatus;(function(AudioStatus){AudioStatus[AudioStatus["LOADING"]=0]="LOADING";AudioStatus[AudioStatus["PAUSED"]=1]="PAUSED";AudioStatus[AudioStatus["PLAYING"]=2]="PLAYING"})(AudioStatus||(AudioStatus={}))});define("engine/audio/AudioManager",["require","exports","core/injector/Injector","core/Core","engine/audio/AudioTagImpl","engine/audio/AudioContextImpl"],function(require,exports,Injector_9,Core_13,AudioTagImpl_1,AudioContextImpl_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AudioManager=function(){function AudioManager(){this._soundImpl=new AudioTagImpl_1.default;this._musicImpl=new AudioContextImpl_1.default}AudioManager.prototype.registerSoundImpl=function(soundImpl){this._soundImpl=soundImpl};AudioManager.prototype.loadSound=function(url){this._soundImpl.load(url)};AudioManager.prototype.playSound=function(params){if(params.stopOthers){this.stopAllSound();this.stopAllMusics()}this._soundImpl.play(params)};AudioManager.prototype.seekSound=function(url,time){this._soundImpl.seek(url,time)};AudioManager.prototype.stopSound=function(url){this._soundImpl.stop(url)};AudioManager.prototype.pauseSound=function(url){this._soundImpl.pause(url)};AudioManager.prototype.stopAllSound=function(){this._soundImpl.stopAll()};AudioManager.prototype.registerMusicImpl=function(musicImpl){this._musicImpl=musicImpl};AudioManager.prototype.loadMusic=function(url){this._musicImpl.load(url)};AudioManager.prototype.playMusic=function(params){if(params.stopOthers){this.stopAllSound();this.stopAllMusics()}this._musicImpl.play(params)};AudioManager.prototype.seekMusic=function(url,time){this._musicImpl.seek(url,time)};AudioManager.prototype.stopMusic=function(url){this._musicImpl.stop(url)};AudioManager.prototype.pauseMusic=function(url){this._musicImpl.pause(url)};AudioManager.prototype.stopAllMusics=function(){this._musicImpl.stopAll()};AudioManager=__decorate([Injector_9.Injectable],AudioManager);return AudioManager}();exports.default=AudioManager;exports.audioManager=Core_13.core.getInject(AudioManager)});define("engine/module/ModuleManager",["require","exports","core/Core","core/injector/Injector","engine/net/NetManager","engine/module/ModuleMessage","engine/env/Environment","engine/mask/MaskManager","engine/assets/AssetsManager","engine/audio/AudioManager","engine/version/Version"],function(require,exports,Core_14,Injector_10,NetManager_1,ModuleMessage_1,Environment_4,MaskManager_3,AssetsManager_2,AudioManager_1,Version_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ModuleManager=function(){function ModuleManager(){this._moduleDict={};this._moduleStack=[];this._openCache=[];this._opening=false}Object.defineProperty(ModuleManager.prototype,"opening",{get:function(){return this._opening},enumerable:true,configurable:true});Object.defineProperty(ModuleManager.prototype,"currentModule",{get:function(){var curData=this.getCurrent();return curData&&curData[0]},enumerable:true,configurable:true});Object.defineProperty(ModuleManager.prototype,"currentModuleInstance",{get:function(){var curData=this.getCurrent();return curData&&curData[1]},enumerable:true,configurable:true});Object.defineProperty(ModuleManager.prototype,"activeCount",{get:function(){return this._moduleStack.length},enumerable:true,configurable:true});ModuleManager.prototype.getIndex=function(cls){for(var i=0,len=this._moduleStack.length;i<len;i++){if(this._moduleStack[i][0]==cls)return i}return-1};ModuleManager.prototype.getModule=function(index){var data=this._moduleStack[index];return data&&data[0]};ModuleManager.prototype.getAfter=function(cls){var result=[];for(var _i=0,_a=this._moduleStack;_i<_a.length;_i++){var module=_a[_i];if(module[0]==cls)return result;result.push(module)}return null};ModuleManager.prototype.getCurrent=function(){return this._moduleStack[0]};ModuleManager.prototype.registerModule=function(cls){this._moduleDict[cls["name"]]=cls};ModuleManager.prototype.isOpened=function(cls){return this._moduleStack.filter(function(temp){return temp[0]==cls}).length>0};ModuleManager.prototype.activateModule=function(module,from,data){if(module){module.onActivate(from,data);var bgMusic=module.bgMusic;if(bgMusic){AudioManager_1.audioManager.playMusic({url:bgMusic,loop:true,stopOthers:true})}}};ModuleManager.prototype.deactivateModule=function(module,to,data){if(module){module.onDeactivate(to,data)}};ModuleManager.prototype.open=function(clsOrName,data,replace){var _this=this;if(replace===void 0){replace=false}var cls=typeof clsOrName=="string"?this._moduleDict[clsOrName]:clsOrName;if(!cls)return;if(this._opening){this._openCache.push([cls,data,replace]);return}this._opening=true;var after=this.getAfter(cls);if(!after){var target=new cls;target.data=data;NetManager_1.netManager.listenRequest(target.observable);var from=this.getCurrent();var fromModule=from&&from[1];this._moduleStack.unshift([cls,target]);var maskFlag=true;var mediators=target.delegatedMediators.concat();var loadMediatorAssets=function(err){if(err){if(!maskFlag)MaskManager_3.maskManager.hideLoading("module");maskFlag=false;target.onLoadAssets(err)}else if(mediators.length>0){var mediator=mediators.shift();mediator.loadAssets(loadMediatorAssets)}else{if(!maskFlag)MaskManager_3.maskManager.hideLoading("module");maskFlag=false;target.onLoadAssets();var cssFiles=target.listStyleFiles();if(cssFiles){for(var _i=0,cssFiles_1=cssFiles;_i<cssFiles_1.length;_i++){var cssFile=cssFiles_1[_i];var cssNode=document.createElement("link");cssNode.rel="stylesheet";cssNode.type="text/css";cssNode.href=Environment_4.environment.toCDNHostURL(Version_2.version.wrapHashUrl(cssFile));document.body.appendChild(cssNode)}}AssetsManager_2.assetsManager.loadAssets(target.listJsFiles(),function(results){if(results instanceof Error){target.onLoadAssets(results);return}if(results){var jsNode=document.createElement("script");jsNode.innerHTML=results.join("\n");document.body.appendChild(jsNode)}var requests=target.listInitRequests();NetManager_1.netManager.sendMultiRequests(requests,function(responses){target.responses=responses;target.onOpen(data);this.deactivateModule(fromModule&&fromModule,cls,data);this.activateModule(target,from&&from[0],data);if(replace)this.close(from&&from[0],data);Core_14.core.dispatch(ModuleMessage_1.default.MODULE_CHANGE,cls,from&&from[0]);this._opening=false;if(this._openCache.length>0)this.open.apply(this,this._openCache.shift())},_this)})}};loadMediatorAssets();if(maskFlag){MaskManager_3.maskManager.showLoading(null,"module");maskFlag=false}}else if(after.length>0){for(var i=1,len=after.length;i<len;i++){this.close(after[i][0],data)}this.close(after[0][0],data);this._opening=false}else{this._opening=false}};ModuleManager.prototype.close=function(clsOrName,data){var cls=typeof clsOrName=="string"?this._moduleDict[clsOrName]:clsOrName;if(!cls)return;if(this.activeCount<=1)return;var index=this.getIndex(cls);if(index<0)return;var target=this._moduleStack[index][1];if(index==0){this._moduleStack.shift();var to=this._moduleStack[0];var toModule=to&&to[1];this.deactivateModule(target,to&&to[0],data);target.onClose(data);this.activateModule(toModule&&toModule,cls,data);Core_14.core.dispatch(ModuleMessage_1.default.MODULE_CHANGE,to&&to[0],cls)}else{this._moduleStack.splice(index,1);target.onClose(data)}};ModuleManager=__decorate([Injector_10.Injectable],ModuleManager);return ModuleManager}();exports.default=ModuleManager;exports.moduleManager=Core_14.core.getInject(ModuleManager)});define("engine/bridge/BridgeManager",["require","exports","core/Core","core/injector/Injector","engine/bridge/BridgeMessage","engine/panel/PanelManager","engine/module/ModuleManager","engine/mask/MaskManager"],function(require,exports,Core_15,Injector_11,BridgeMessage_1,PanelManager_2,ModuleManager_1,MaskManager_4){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var BridgeManager=function(){function BridgeManager(){this._bridgeDict={};this._bridgeList=[]}Object.defineProperty(BridgeManager.prototype,"currentBridge",{get:function(){var curModule=ModuleManager_1.moduleManager.currentModuleInstance;if(curModule){var bridge;var mediators=curModule.delegatedMediators;for(var _i=0,mediators_1=mediators;_i<mediators_1.length;_i++){var mediator=mediators_1[_i];if(mediator.bridge)return mediator.bridge}}return this._bridgeList[0]&&this._bridgeList[0][0]},enumerable:true,configurable:true});BridgeManager.prototype.getBridge=function(type){var data=this._bridgeDict[type];return data&&data[0]};BridgeManager.prototype.getBridgeBySkin=function(skin){if(skin){for(var _i=0,_a=this._bridgeList;_i<_a.length;_i++){var data=_a[_i];var bridge=data[0];if(bridge.isMySkin(skin))return bridge}}return null};BridgeManager.prototype.registerBridge=function(){var _this=this;var bridges=[];for(var _i=0;_i<arguments.length;_i++){bridges[_i]=arguments[_i]}if(!document.body){var onLoad=function(evt){window.removeEventListener("load",onLoad);_this.registerBridge.apply(_this,bridges)};window.addEventListener("load",onLoad);return}if(bridges.length>0){var self=this;for(var _a=0,bridges_1=bridges;_a<bridges_1.length;_a++){var bridge=bridges_1[_a];var type=bridge.type;if(!this._bridgeDict[type]){var data=[bridge,false];this._bridgeDict[type]=data;this._bridgeList.push(data)}}for(var _b=0,bridges_2=bridges;_b<bridges_2.length;_b++){var bridge=bridges_2[_b];Core_15.core.dispatch(BridgeMessage_1.default.BRIDGE_BEFORE_INIT,bridge);MaskManager_4.maskManager.registerMask(bridge.type,bridge.maskEntity);PanelManager_2.panelManager.registerPrompt(bridge.type,bridge.promptClass);if(bridge.init)bridge.init(afterInitBridge);else afterInitBridge(bridge)}}else{this.testAllInit()}function afterInitBridge(bridge){bridge.htmlWrapper.style.display="none";Core_15.core.dispatch(BridgeMessage_1.default.BRIDGE_AFTER_INIT,bridge);var data=self._bridgeDict[bridge.type];data[1]=true;self.testAllInit()}};BridgeManager.prototype.testAllInit=function(){var allInited=true;for(var _i=0,_a=this._bridgeList;_i<_a.length;_i++){var data=_a[_i];allInited=allInited&&data[1]}if(allInited)Core_15.core.dispatch(BridgeMessage_1.default.BRIDGE_ALL_INIT)};BridgeManager=__decorate([Injector_11.Injectable],BridgeManager);return BridgeManager}();exports.default=BridgeManager;exports.bridgeManager=Core_15.core.getInject(BridgeManager)});define("engine/platform/IPlatform",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/platform/WebPlatform",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var WebPlatform=function(){function WebPlatform(){}WebPlatform.prototype.reload=function(){window.location.reload(true)};return WebPlatform}();exports.default=WebPlatform});define("engine/platform/PlatformManager",["require","exports","core/Core","core/injector/Injector","engine/platform/WebPlatform"],function(require,exports,Core_16,Injector_12,WebPlatform_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var PlatformManager=function(){function PlatformManager(){this.platform=new WebPlatform_1.default}PlatformManager.prototype.reload=function(){this.platform.reload()};PlatformManager=__decorate([Injector_12.Injectable],PlatformManager);return PlatformManager}();exports.default=PlatformManager;exports.platformManager=Core_16.core.getInject(PlatformManager)});define("engine/model/Model",["require","exports","core/Core"],function(require,exports,Core_17){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Model=function(){function Model(){}Model.prototype.dispatch=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}Core_17.core.dispatch.apply(Core_17.core,params)};Model.prototype.listen=function(type,handler,thisArg){Core_17.core.listen(type,handler,thisArg)};Model.prototype.unlisten=function(type,handler,thisArg){Core_17.core.unlisten(type,handler,thisArg)};Model.prototype.mapCommand=function(type,cmd){Core_17.core.mapCommand(type,cmd)};Model.prototype.unmapCommand=function(type,cmd){Core_17.core.unmapCommand(type,cmd)};return Model}();exports.default=Model});define("engine/bind/Utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function wrapEvalFuncExp(exp,scopeCount){var argList=[];var expStr=exp;for(var i=0;i<scopeCount;i++){argList.push("s"+i);expStr="with(s"+(scopeCount-1-i)+"||{}){"+expStr+"}"}return Function(argList.join(","),expStr)}function createRunFunc(exp,scopeCount){if(scopeCount===void 0){scopeCount=0}var func;try{func=wrapEvalFuncExp(exp,scopeCount)}catch(err){var sepStr=exp.indexOf('"')<0?'"':"'";var reg=/([^\\]?)`/g;exp=exp.replace(reg,"$1"+sepStr);reg=/\$\{(.*?)\}/g;exp=exp.replace(reg,sepStr+"+($1)+"+sepStr);func=wrapEvalFuncExp(exp,scopeCount)}return func}exports.createRunFunc=createRunFunc;function runExp(exp,thisArg){var scopes=[];for(var _i=2;_i<arguments.length;_i++){scopes[_i-2]=arguments[_i]}createRunFunc(exp,scopes.length).apply(thisArg,scopes)}exports.runExp=runExp;function createEvalFunc(exp,scopeCount){if(scopeCount===void 0){scopeCount=0}return createRunFunc("return "+exp,scopeCount)}exports.createEvalFunc=createEvalFunc;function evalExp(exp,thisArg){var scopes=[];for(var _i=2;_i<arguments.length;_i++){scopes[_i-2]=arguments[_i]}return createEvalFunc(exp,scopes.length).apply(thisArg,scopes)}exports.evalExp=evalExp});define("engine/bind/Bind",["require","exports","engine/bind/Watcher","utils/ObjectUtil"],function(require,exports,Watcher_1,ObjectUtil_6){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Bind=function(){function Bind(mediator){this._watcherDict={};this._mediator=mediator}Object.defineProperty(Bind.prototype,"mediator",{get:function(){return this._mediator},enumerable:true,configurable:true});Bind.prototype.createWatcher=function(target,exp,callback){var scopes=[];for(var _i=3;_i<arguments.length;_i++){scopes[_i-3]=arguments[_i]}var key=ObjectUtil_6.getObjectHashs.apply(void 0,[target,exp].concat(scopes));var watcher=this._watcherDict[key];if(!watcher)this._watcherDict[key]=watcher=new(Watcher_1.default.bind.apply(Watcher_1.default,[void 0,this,target,exp,callback].concat(scopes)));return watcher};return Bind}();exports.default=Bind});define("engine/bind/Watcher",["require","exports","engine/bind/Utils"],function(require,exports,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Watcher=function(){function Watcher(bind,target,exp,callback){var scopes=[];for(var _i=4;_i<arguments.length;_i++){scopes[_i-4]=arguments[_i]}this._disposed=false;this._bind=bind;this._target=target;this._exp=exp;this._scopes=scopes;this._expFunc=Utils_1.createEvalFunc(exp,1+scopes.length);this._callback=callback;this.update()}Watcher.prototype.getValue=function(){if(this._disposed)return null;var value;Watcher.updating=this;var commonScope={$this:this._bind.mediator,$bridge:this._bind.mediator.bridge,$target:this._target};try{value=(_a=this._expFunc).call.apply(_a,[this._scopes[0],commonScope].concat(this._scopes))}catch(err){console.warn("表达式求值错误\nerr: "+err.toString()+"\nexp："+this._exp+"，scopes："+JSON.stringify(this._scopes))}Watcher.updating=null;return value;var _a};Watcher.prototype.update=function(extra){if(this._disposed)return;var value=this.getValue();if(!Watcher.isEqual(value,this._value)){this._callback&&this._callback(value,this._value,extra);this._value=Watcher.deepCopy(value)}};Watcher.prototype.dispose=function(){if(this._disposed)return;this._value=null;this._target=null;this._exp=null;this._scopes=null;this._expFunc=null;this._callback=null;this._disposed=true};Watcher.isEqual=function(a,b){return a==b||(Watcher.isObject(a)&&Watcher.isObject(b)?JSON.stringify(a)==JSON.stringify(b):false)};Watcher.isObject=function(obj){return obj&&typeof obj=="object"};Watcher.deepCopy=function(from){if(Watcher.isObject(from)){try{return JSON.parse(JSON.stringify(from))}catch(err){}}return from};Watcher.updating=null;Watcher._uid=0;return Watcher}();exports.default=Watcher});define("engine/bind/Dep",["require","exports","utils/Dictionary"],function(require,exports,Dictionary_4){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Dep=function(){function Dep(){this._map=new Dictionary_4.default}Dep.prototype.watch=function(watcher){this._map.set(watcher,watcher)};Dep.prototype.notify=function(extra){this._map.forEach(function(watcher){watcher.update(extra)})};return Dep}();exports.default=Dep});define("engine/bind/Mutator",["require","exports","utils/ObjectUtil","engine/bind/Dep","engine/bind/Watcher"],function(require,exports,ObjectUtil_7,Dep_1,Watcher_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _arrMethods=["push","pop","unshift","shift","splice","sort","reverse"];function mutate(data){if(!data||typeof data!="object")return data;for(var key in data){mutateObject(data,key,data[key])}return data}exports.mutate=mutate;function mutateObject(data,key,value){var depKey=ObjectUtil_7.getObjectHashs(data,key);var dep=data[depKey];if(!dep){dep=new Dep_1.default;Object.defineProperty(data,key,{enumerable:true,configurable:false,get:function(){var watcher=Watcher_2.default.updating;if(watcher)dep.watch(watcher);return value},set:function(v){if(v==value)return;value=v;if(Array.isArray(v))mutateArray(v,dep);else mutate(v);dep.notify()}});Object.defineProperty(data,depKey,{value:dep,writable:false,enumerable:false,configurable:false})}mutate(value)}function mutateArray(arr,dep){arr["__proto__"]=defineReactiveArray(dep);for(var i=0,len=arr.length;i<len;i++){mutate(arr[i])}}function defineReactiveArray(dep){var proto=Array.prototype;var result=Object.create(proto);_arrMethods.forEach(function(method){var oriMethod=proto[method];Object.defineProperty(result,method,{value:function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var result=oriMethod.apply(this,args);var inserted;switch(method){case"push":case"unshift":inserted=args;break;case"splice":inserted=args.slice(2);break}if(inserted&&inserted.length){mutateArray(inserted,dep)}dep.notify({method:args});return result}})});Object.defineProperty(result,"$set",{value:function(index,value){if(index>=this.length)index=this.length;return this.splice(index,1,value)[0]}});Object.defineProperty(result,"$remove",{value:function(item){var index=this.indexOf(item);if(index>-1)return this.splice(index,1);return null}});return result}});define("engine/bind/BindManager",["require","exports","core/injector/Injector","core/Core","utils/Dictionary","engine/bind/Bind","engine/bind/Utils","engine/net/NetManager"],function(require,exports,Injector_13,Core_18,Dictionary_5,Bind_1,Utils_2,NetManager_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var BindManager=function(){function BindManager(){this._bindDict=new Dictionary_5.default;this._envModel=[];this._regExp=/^\s*(\w+)\s+((in)|(of))\s+(.+?)\s*$/}BindManager.prototype.bind=function(mediator){var bindData=this._bindDict.get(mediator);if(!bindData){this._bindDict.set(mediator,bindData={bind:new Bind_1.default(mediator),callbacks:[]})}for(var _i=0,_a=bindData.callbacks;_i<_a.length;_i++){var callback=_a[_i];callback()}return bindData.bind};BindManager.prototype.unbind=function(mediator){var bindData=this._bindDict.get(mediator);if(bindData)this._bindDict.delete(mediator);return bindData&&bindData.bind};BindManager.prototype.search=function(values,ui,callback){for(var key in values){var value=values[key];var index=key.indexOf(".");if(index>=0){var newValue={};newValue[key.substr(index+1)]=value;this.search(newValue,ui[key.substring(0,index)],callback)}else if(typeof value=="object"&&!(value instanceof Array)){this.search(value,ui[key],callback)}else{callback(ui,key,value)}}};BindManager.prototype.delaySearch=function(mediator,values,ui,callback){var _this=this;var handler=function(){if(!mediator.viewModel)return;_this.search(values,ui,callback)};var bindData=this._bindDict.get(mediator);if(bindData.callbacks.indexOf(handler)<0)bindData.callbacks.push(handler);handler()};BindManager.prototype.bindValue=function(mediator,ui,uiDict){var _this=this;var bindData=this._bindDict.get(mediator);this.delaySearch(mediator,uiDict,ui,function(ui,key,exp){(_a=bindData.bind).createWatcher.apply(_a,[ui,exp,function(value){ui[key]=value},mediator.viewModel].concat(_this._envModel));var _a})};BindManager.prototype.bindFunc=function(mediator,ui,funcDict){var _this=this;var bindData=this._bindDict.get(mediator);this.delaySearch(mediator,funcDict,ui,function(ui,key,exp){if(exp){var exps;if(typeof exp=="string"){exps=[exp]}else{exps=exp}var undefinedValue=Date.now()*Math.random()+"_undefined";var nullValue=Date.now()*Math.random()+"_null";exps=exps.map(function(value){if(value===undefined)return"'"+undefinedValue+"'";else if(value===null)return"'"+nullValue+"'";else return value});var initValue={};var args=[];var argsInited=false;var handler=function(index,value){if(value===undefinedValue)value=undefined;else if(value==nullValue)value=null;args[index]=value;if(!argsInited){for(var _i=0,args_2=args;_i<args_2.length;_i++){var arg=args_2[_i];if(arg===initValue)return}argsInited=true}ui[key].apply(ui,args)};for(var i=0,len=exps.length;i<len;i++){args.push(initValue)}for(var i=0,len=exps.length;i<len;i++){(_a=bindData.bind).createWatcher.apply(_a,[ui,exps[i],handler.bind(_this,i),mediator.viewModel].concat(_this._envModel))}}else{ui[key]()}var _a})};BindManager.prototype.bindOn=function(mediator,ui,evtDict){var _this=this;this.delaySearch(mediator,evtDict,ui,function(ui,key,exp){var handler=mediator.viewModel[exp];var commonScope={$this:mediator,$data:mediator.viewModel,$bridge:mediator.bridge,$target:ui};if(!handler){var func=Utils_2.createRunFunc(exp,2+_this._envModel.length);var envModel=_this._envModel.concat();handler=function(){func.call.apply(func,[this,mediator.viewModel].concat(envModel,[commonScope]))}}mediator.bridge.mapListener(ui,key,handler,mediator.viewModel)})};BindManager.prototype.replaceDisplay=function(bridge,ori,cur){var parent=bridge.getParent(ori);if(parent){var index=bridge.getChildIndex(parent,ori);bridge.removeChild(parent,ori);bridge.addChildAt(parent,cur,index)}};BindManager.prototype.bindIf=function(mediator,ui,uiDict,callback){var _this=this;var bindData=this._bindDict.get(mediator);var replacer=mediator.bridge.createEmptyDisplay();this.delaySearch(mediator,uiDict,ui,function(ui,key,exp){ui=ui[key]||ui;(_a=bindData.bind).createWatcher.apply(_a,[ui,exp,function(value){if(value)_this.replaceDisplay(mediator.bridge,replacer,ui);else _this.replaceDisplay(mediator.bridge,ui,replacer);callback&&callback(value)},mediator.viewModel].concat(_this._envModel));var _a})};BindManager.prototype.bindFor=function(mediator,ui,uiDict,callback){var _this=this;var bindData=this._bindDict.get(mediator);var replacer=mediator.bridge.createEmptyDisplay();this.delaySearch(mediator,uiDict,ui,function(ui,key,exp){ui=ui[key]||ui;var res=_this._regExp.exec(exp);if(!res)return;var memento=mediator.bridge.wrapBindFor(ui,function(key,value,renderer){var commonScope={$key:key,$value:value,$target:renderer};commonScope[res[1]]=res[2]=="in"?key:value;_this._envModel.push(commonScope);callback&&callback(value,renderer);_this._envModel.splice(_this._envModel.indexOf(commonScope),1)});var bindData=_this._bindDict.get(mediator);(_a=bindData.bind).createWatcher.apply(_a,[ui,res[5],function(datas){mediator.bridge.valuateBindFor(ui,datas,memento)},mediator.viewModel].concat(_this._envModel));var _a})};BindManager.prototype.bindMessage=function(mediator,ui,type,uiDict,observable){var _this=this;if(!observable)observable=Core_18.core.observable;var bindData=this._bindDict.get(mediator);var handler=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(mediator.disposed){observable.unlisten(type,handler)}else{var msg;if(args.length==1&&typeof args[0]=="object"&&args[0].type)msg=args[0];else msg={$arguments:args};_this.search(uiDict,ui,function(ui,key,exp){var commonScope={$this:mediator,$data:mediator.viewModel,$bridge:mediator.bridge,$target:ui};ui[key]=Utils_2.evalExp.apply(void 0,[exp,mediator.viewModel,msg,mediator.viewModel].concat(_this._envModel,[commonScope]))})}};observable.listen(type,handler)};BindManager.prototype.bindResponse=function(mediator,ui,type,uiDict,observable){var _this=this;if(!observable)observable=Core_18.core.observable;var bindData=this._bindDict.get(mediator);var handler=function(response){if(mediator.disposed){NetManager_2.netManager.unlistenResponse(type,handler,null,null,observable)}else{_this.search(uiDict,ui,function(ui,key,exp){var commonScope={$this:mediator,$data:mediator.viewModel,$bridge:mediator.bridge,$target:ui};ui[key]=Utils_2.evalExp.apply(void 0,[exp,mediator.viewModel,response,mediator.viewModel].concat(_this._envModel,[commonScope]))})}};NetManager_2.netManager.listenResponse(type,handler,null,null,observable);if(mediator["dependModuleInstance"]){for(var _i=0,_a=mediator["dependModuleInstance"].responses;_i<_a.length;_i++){var response=_a[_i];handler(response)}}};BindManager=__decorate([Injector_13.Injectable],BindManager);return BindManager}();exports.default=BindManager;exports.bindManager=Core_18.core.getInject(BindManager)});define("engine/mediator/Mediator",["require","exports","core/Core","engine/bind/Mutator","engine/bind/BindManager"],function(require,exports,Core_19,Mutator_1,BindManager_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Mediator=function(){function Mediator(skin){this._disposed=false;this._listeners=[];if(skin)this.skin=skin;BindManager_1.bindManager.bind(this)}Object.defineProperty(Mediator.prototype,"viewModel",{get:function(){return this._viewModel},set:function(value){this._viewModel=Mutator_1.mutate(value);BindManager_1.bindManager.bind(this)},enumerable:true,configurable:true});Object.defineProperty(Mediator.prototype,"disposed",{get:function(){return this._disposed},enumerable:true,configurable:true});Object.defineProperty(Mediator.prototype,"dependModuleInstance",{get:function(){return this._dependModuleInstance},enumerable:true,configurable:true});Object.defineProperty(Mediator.prototype,"dependModule",{get:function(){return this._dependModule},enumerable:true,configurable:true});Object.defineProperty(Mediator.prototype,"data",{get:function(){return this._data},enumerable:true,configurable:true});Mediator.prototype.listAssets=function(){return null};Mediator.prototype.loadAssets=function(handler){var self=this;this.bridge.loadAssets(this.listAssets(),this,function(err){self.onLoadAssets(err);handler(err)})};Mediator.prototype.onLoadAssets=function(err){};Mediator.prototype.open=function(data){this._data=data;this.onOpen(data);if(!this._viewModel)this.viewModel={};return this};Mediator.prototype.close=function(data){this.onClose(data);this.dispose();return this};Mediator.prototype.onOpen=function(data){};Mediator.prototype.onClose=function(data){};Mediator.prototype.mapListener=function(target,type,handler,thisArg){for(var i=0,len=this._listeners.length;i<len;i++){var data=this._listeners[i];if(data.target==target&&data.type==type&&data.handler==handler&&data.thisArg==thisArg){return}}this._listeners.push({target:target,type:type,handler:handler,thisArg:thisArg});this.bridge.mapListener(target,type,handler,thisArg)};Mediator.prototype.unmapListener=function(target,type,handler,thisArg){for(var i=0,len=this._listeners.length;i<len;i++){var data=this._listeners[i];if(data.target==target&&data.type==type&&data.handler==handler&&data.thisArg==thisArg){this.bridge.unmapListener(target,type,handler,thisArg);this._listeners.splice(i,1);break}}};Mediator.prototype.unmapAllListeners=function(){for(var i=0,len=this._listeners.length;i<len;i++){var data=this._listeners.pop();this.bridge.unmapListener(data.target,data.type,data.handler,data.thisArg)}};Mediator.prototype.dispatch=function(typeOrMsg){var params=[];for(var _i=1;_i<arguments.length;_i++){params[_i-1]=arguments[_i]}Core_19.core.dispatch.apply(Core_19.core,[typeOrMsg].concat(params))};Object.defineProperty(Mediator.prototype,"observable",{get:function(){return this._dependModuleInstance&&this._dependModuleInstance.observable},enumerable:true,configurable:true});Mediator.prototype.listenModule=function(type,handler,thisArg){this._dependModuleInstance&&this._dependModuleInstance.listenModule(type,handler,thisArg)};Mediator.prototype.unlistenModule=function(type,handler,thisArg){this._dependModuleInstance&&this._dependModuleInstance.unlistenModule(type,handler,thisArg)};Mediator.prototype.mapCommandModule=function(type,cmd){this._dependModuleInstance&&this._dependModuleInstance.mapCommandModule(type,cmd)};Mediator.prototype.unmapCommandModule=function(type,cmd){this._dependModuleInstance&&this._dependModuleInstance.unmapCommandModule(type,cmd)};Mediator.prototype.dispatchModule=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this._dependModuleInstance&&this._dependModuleInstance.dispatchModule.apply(this._dependModuleInstance,params)};Mediator.prototype.dispose=function(){if(this._disposed)return;if(this.skin&&this.bridge){var parent=this.bridge.getParent(this.skin);if(parent)this.bridge.removeChild(parent,this.skin)}this.unmapAllListeners();this.bridge=null;BindManager_1.bindManager.unbind(this);this._viewModel=null;this.skin=null;this._disposed=true};return Mediator}();exports.default=Mediator});define("engine/panel/PanelMediator",["require","exports","engine/mediator/Mediator","engine/panel/PanelManager"],function(require,exports,Mediator_1,PanelManager_3){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var PanelMediator=function(_super){__extends(PanelMediator,_super);function PanelMediator(skin,policy){var _this=_super.call(this,skin)||this;_this.policy=policy;return _this}PanelMediator.prototype.open=function(data,isModel,from){return PanelManager_3.panelManager.pop(this,data,isModel,from)};PanelMediator.prototype.__open=function(data,isModel,from){_super.prototype.open.call(this,data)};PanelMediator.prototype.close=function(data,to){return PanelManager_3.panelManager.drop(this,data,to)};PanelMediator.prototype.__close=function(data,to){_super.prototype.close.call(this,data)};PanelMediator.prototype.onBeforePop=function(data,isModel,from){};PanelMediator.prototype.onAfterPop=function(data,isModel,from){};PanelMediator.prototype.onBeforeDrop=function(data,to){};PanelMediator.prototype.onAfterDrop=function(data,to){};return PanelMediator}(Mediator_1.default);exports.default=PanelMediator});define("engine/scene/NoneScenePolicy",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var NoneScenePolicy=function(){function NoneScenePolicy(){}NoneScenePolicy.prototype.prepareSwitch=function(from,to){};NoneScenePolicy.prototype.switch=function(from,to,callback){setTimeout(callback,0)};return NoneScenePolicy}();exports.NoneScenePolicy=NoneScenePolicy;exports.default=new NoneScenePolicy});define("engine/scene/SceneMessage",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SceneMessage=function(){function SceneMessage(){}SceneMessage.SCENE_BEFORE_CHANGE="sceneBeforeChange";SceneMessage.SCENE_AFTER_CHANGE="sceneAfterChange";return SceneMessage}();exports.default=SceneMessage});define("utils/SyncUtil",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _cache={};function isOperating(name){var ctx=_cache[name];return ctx!=null&&ctx.operating}exports.isOperating=isOperating;function wait(name,fn,thisArg){var args=[];for(var _i=3;_i<arguments.length;_i++){args[_i-3]=arguments[_i]}var ctx=_cache[name];if(ctx==null){_cache[name]=ctx={operating:false,datas:[]}}if(ctx.operating){ctx.datas.push({fn:fn,thisArg:thisArg,args:args})}else{ctx.operating=true;fn.apply(thisArg,args)}}exports.wait=wait;function notify(name){var ctx=_cache[name];if(ctx==null||ctx.datas.length<=0){ctx.operating=false;return}var data=ctx.datas.shift();data.fn.apply(data.thisArg,data.args)}exports.notify=notify});define("engine/scene/SceneManager",["require","exports","core/Core","core/injector/Injector","engine/scene/NoneScenePolicy","engine/scene/SceneMessage","utils/SyncUtil"],function(require,exports,Core_20,Injector_14,NoneScenePolicy_1,SceneMessage_1,SyncUtil_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SYNC_NAME="SceneManager_sync";var ChangeType;(function(ChangeType){ChangeType[ChangeType["Switch"]=0]="Switch";ChangeType[ChangeType["Push"]=1]="Push";ChangeType[ChangeType["Pop"]=2]="Pop"})(ChangeType||(ChangeType={}));var SceneManager=function(){function SceneManager(){this._sceneStack=[]}Object.defineProperty(SceneManager.prototype,"currentScene",{get:function(){return this._sceneStack[0]},enumerable:true,configurable:true});Object.defineProperty(SceneManager.prototype,"activeCount",{get:function(){return this._sceneStack.length},enumerable:true,configurable:true});SceneManager.prototype.isOpened=function(scene){return this._sceneStack.indexOf(scene)>=0};SceneManager.prototype.switch=function(scene,data){var _this=this;if(scene==null)return;if(this.activeCount==0)return this.push(scene,data);SyncUtil_1.wait(SYNC_NAME,this.doChange,this,this.currentScene,scene,data,scene.policy||scene.bridge.defaultScenePolicy||NoneScenePolicy_1.default,ChangeType.Switch,function(){var lastScene=_this._sceneStack[0];_this._sceneStack[0]=scene;lastScene&&lastScene.__close(data);scene.__open(data)});return scene};SceneManager.prototype.push=function(scene,data){var _this=this;if(scene==null)return scene;SyncUtil_1.wait(SYNC_NAME,this.doChange,this,this.currentScene,scene,data,scene.policy||scene.bridge.defaultScenePolicy||NoneScenePolicy_1.default,ChangeType.Push,function(){_this._sceneStack.unshift(scene);scene.__open(data)});return scene};SceneManager.prototype.pop=function(scene,data){if(scene==null)return scene;SyncUtil_1.wait(SYNC_NAME,this.doPop,this,scene,data);return scene};SceneManager.prototype.doPop=function(scene,data){var _this=this;if(this.activeCount<=1){console.log("场景栈中的场景数量不足，无法执行pop操作");SyncUtil_1.notify(SYNC_NAME);return}var to=this._sceneStack[1];var policy=scene.policy||scene.bridge.defaultScenePolicy||NoneScenePolicy_1.default;if(this._sceneStack.indexOf(scene)!=0){to=null;policy=NoneScenePolicy_1.default}this.doChange(scene,to,data,policy,ChangeType.Pop,function(){_this._sceneStack.splice(_this._sceneStack.indexOf(scene),1)},function(){scene.__close(data)})};SceneManager.prototype.doChange=function(from,to,data,policy,type,begin,complete){if(!from||!to)policy=NoneScenePolicy_1.default;if(to)to.bridge.htmlWrapper.style.display="";if(from&&to&&to.bridge.type!=from.bridge.type){from.bridge.htmlWrapper.style.display="none";policy=NoneScenePolicy_1.default}begin&&begin();var prepareFunc;var doFunc;switch(type){case ChangeType.Switch:prepareFunc=policy.prepareSwitch;doFunc=policy.switch;break;case ChangeType.Push:prepareFunc=policy.preparePush||policy.prepareSwitch;doFunc=policy.push||policy.switch;break;case ChangeType.Pop:prepareFunc=policy.preparePop||policy.prepareSwitch;doFunc=policy.pop||policy.switch;break}to&&from&&from.onBeforeOut(to,data);to&&to.onBeforeIn(from,data);Core_20.core.dispatch(SceneMessage_1.default.SCENE_BEFORE_CHANGE,to,from);prepareFunc&&prepareFunc.call(policy,from,to);to&&to.bridge.addChild(to.bridge.sceneLayer,to.skin);doFunc.call(policy,from,to,function(){to&&from&&from.bridge.removeChild(from.bridge.sceneLayer,from.skin);complete&&complete();to&&from&&from.onAfterOut(to,data);to&&to.onAfterIn(from,data);Core_20.core.dispatch(SceneMessage_1.default.SCENE_AFTER_CHANGE,to,from);SyncUtil_1.notify(SYNC_NAME)})};SceneManager=__decorate([Injector_14.Injectable],SceneManager);return SceneManager}();exports.default=SceneManager;exports.sceneManager=Core_20.core.getInject(SceneManager)});define("engine/scene/SceneMediator",["require","exports","engine/mediator/Mediator","engine/scene/SceneManager"],function(require,exports,Mediator_2,SceneManager_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SceneMediator=function(_super){__extends(SceneMediator,_super);function SceneMediator(skin,policy){var _this=_super.call(this,skin)||this;_this.policy=policy;return _this}SceneMediator.prototype.open=function(data){return SceneManager_1.sceneManager.push(this,data)};SceneMediator.prototype.__open=function(data){_super.prototype.open.call(this,data)};SceneMediator.prototype.close=function(data){return SceneManager_1.sceneManager.pop(this,data)};SceneMediator.prototype.__close=function(data){_super.prototype.close.call(this,data)};SceneMediator.prototype.onBeforeIn=function(fromScene,data){};SceneMediator.prototype.onAfterIn=function(fromScene,data){};SceneMediator.prototype.onBeforeOut=function(toScene,data){};SceneMediator.prototype.onAfterOut=function(toScene,data){};return SceneMediator}(Mediator_2.default);exports.default=SceneMediator});define("engine/module/Module",["require","exports","core/Core","core/observable/Observable","utils/Dictionary","engine/module/ModuleManager","utils/ConstructUtil"],function(require,exports,Core_21,Observable_2,Dictionary_6,ModuleManager_2,ConstructUtil_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Module=function(){function Module(){this._disposed=false;this._mediators=[];this._disposeDict=new Dictionary_6.default;this._observable=new Observable_2.default}Object.defineProperty(Module.prototype,"disposed",{get:function(){return this._disposed},enumerable:true,configurable:true});Object.defineProperty(Module.prototype,"bgMusic",{get:function(){return null},enumerable:true,configurable:true});Object.defineProperty(Module.prototype,"dependModuleInstance",{get:function(){return this},enumerable:true,configurable:true});Object.defineProperty(Module.prototype,"dependModule",{get:function(){return ConstructUtil_2.getConstructor(this.constructor)},enumerable:true,configurable:true});Object.defineProperty(Module.prototype,"delegatedMediators",{get:function(){return this._mediators},enumerable:true,configurable:true});Module.prototype.disposeMediator=function(mediator){this.undelegateMediator(mediator);mediator.dispose();if(this._mediators.length<=0)this.dispose()};Module.prototype.delegateMediator=function(mediator){if(this._mediators.indexOf(mediator)<0){this._mediators.push(mediator);if(mediator.hasOwnProperty("dispose"))this._disposeDict.set(mediator,mediator.dispose);mediator.dispose=this.disposeMediator.bind(this,mediator)}};Module.prototype.undelegateMediator=function(mediator){var index=this._mediators.indexOf(mediator);if(index>=0){this._mediators.splice(index,1);var oriDispose=this._disposeDict.get(mediator);if(oriDispose)mediator.dispose=oriDispose;else delete mediator.dispose;this._disposeDict.delete(mediator)}};Module.prototype.constainsMediator=function(mediator){return this._mediators.indexOf(mediator)>=0};Module.prototype.listStyleFiles=function(){return null};Module.prototype.listJsFiles=function(){return null};Module.prototype.listInitRequests=function(){return null};Module.prototype.onLoadAssets=function(err){};Module.prototype.onOpen=function(data){for(var _i=0,_a=this._mediators;_i<_a.length;_i++){var mediator=_a[_i];mediator.open(data)}};Module.prototype.onClose=function(data){for(var _i=0,_a=this._mediators.concat();_i<_a.length;_i++){var mediator=_a[_i];mediator.close(data)}};Module.prototype.onActivate=function(from,data){};Module.prototype.onDeactivate=function(to,data){};Module.prototype.dispatch=function(typeOrMsg){var params=[];for(var _i=1;_i<arguments.length;_i++){params[_i-1]=arguments[_i]}Core_21.core.dispatch.apply(Core_21.core,[typeOrMsg].concat(params))};Object.defineProperty(Module.prototype,"observable",{get:function(){return this._observable},enumerable:true,configurable:true});Module.prototype.listenModule=function(type,handler,thisArg){this._observable.listen(type,handler,thisArg)};Module.prototype.unlistenModule=function(type,handler,thisArg){this._observable.unlisten(type,handler,thisArg)};Module.prototype.mapCommandModule=function(type,cmd){this._observable.mapCommand(type,cmd)};Module.prototype.unmapCommandModule=function(type,cmd){this._observable.unmapCommand(type,cmd)};Module.prototype.dispatchModule=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this._observable.dispatch.apply(this._observable,params)};Module.prototype.dispose=function(){if(this._disposed)return;var cls=ConstructUtil_2.getConstructor(this.constructor);ModuleManager_2.moduleManager.close(cls);if(ModuleManager_2.moduleManager.isOpened(cls))return;for(var i=0,len=this._mediators.length;i<len;i++){var mediator=this._mediators.pop();this.undelegateMediator(mediator);mediator.dispose()}this._observable.dispose();this._observable=null;this._disposed=true};return Module}();exports.default=Module});define("engine/env/Explorer",["require","exports","core/Core","core/injector/Injector"],function(require,exports,Core_22,Injector_15){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ExplorerType;(function(ExplorerType){ExplorerType[ExplorerType["IE"]=0]="IE";ExplorerType[ExplorerType["EDGE"]=1]="EDGE";ExplorerType[ExplorerType["OPERA"]=2]="OPERA";ExplorerType[ExplorerType["FIREFOX"]=3]="FIREFOX";ExplorerType[ExplorerType["SAFARI"]=4]="SAFARI";ExplorerType[ExplorerType["CHROME"]=5]="CHROME";ExplorerType[ExplorerType["OTHERS"]=6]="OTHERS"})(ExplorerType=exports.ExplorerType||(exports.ExplorerType={}));var Explorer=function(){function Explorer(){var userAgent=navigator.userAgent;var regExp;var result;if(window["ActiveXObject"]!=null){this._type=ExplorerType.IE;regExp=new RegExp("MSIE ([^ ;\\)]+);");result=regExp.exec(userAgent);if(result!=null){this._version=result[1]}else{regExp=new RegExp("rv:([^ ;\\)]+)");result=regExp.exec(userAgent);this._version=result[1]}}else if(userAgent.indexOf("Edge")>-1){this._type=ExplorerType.EDGE;regExp=new RegExp("Edge/([^ ;\\)]+)");result=regExp.exec(userAgent);this._version=result[1]}else if(userAgent.indexOf("Firefox")>-1){this._type=ExplorerType.FIREFOX;regExp=new RegExp("Firefox/([^ ;\\)]+)");result=regExp.exec(userAgent);this._version=result[1]}else if(userAgent.indexOf("Opera")>-1){this._type=ExplorerType.OPERA;regExp=new RegExp("OPR/([^ ;\\)]+)");result=regExp.exec(userAgent);this._version=result[1]}else if(userAgent.indexOf("Chrome")>-1){this._type=ExplorerType.CHROME;regExp=new RegExp("Chrome/([^ ;\\)]+)");result=regExp.exec(userAgent);this._version=result[1]}else if(userAgent.indexOf("Safari")>-1){this._type=ExplorerType.SAFARI;regExp=new RegExp("Safari/([^ ;\\)]+)");result=regExp.exec(userAgent);this._version=result[1]}else{this._type=ExplorerType.OTHERS;this._version="0.0"}this._typeStr=ExplorerType[this._type];this._bigVersion=this._version.split(".")[0]}Object.defineProperty(Explorer.prototype,"type",{get:function(){return this._type},enumerable:true,configurable:true});Object.defineProperty(Explorer.prototype,"typeStr",{get:function(){return this._typeStr},enumerable:true,configurable:true});Object.defineProperty(Explorer.prototype,"version",{get:function(){return this._version},enumerable:true,configurable:true});Object.defineProperty(Explorer.prototype,"bigVersion",{get:function(){return this._bigVersion},enumerable:true,configurable:true});Explorer=__decorate([Injector_15.Injectable,__metadata("design:paramtypes",[])],Explorer);return Explorer}();exports.default=Explorer;exports.explorer=Core_22.core.getInject(Explorer)});define("engine/env/WindowExternal",["require","exports","core/Core","core/injector/Injector"],function(require,exports,Core_23,Injector_16){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var WindowExternal=function(){function WindowExternal(){this._params={};try{if(!(window.external&&typeof window.external==="object")){window.external={}}}catch(err){window.external={}}this._params=window.external}Object.defineProperty(WindowExternal.prototype,"params",{get:function(){return this._params},enumerable:true,configurable:true});WindowExternal.prototype.getParam=function(key){return this._params[key]};WindowExternal=__decorate([Injector_16.Injectable,__metadata("design:paramtypes",[])],WindowExternal);return WindowExternal}();exports.default=WindowExternal;exports.windowExternal=Core_23.core.getInject(WindowExternal)});define("engine/env/Hash",["require","exports","core/Core","core/injector/Injector"],function(require,exports,Core_24,Injector_17){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Hash=function(){function Hash(){this._params={};this._direct=false;this._keepHash=false;this._hash=window.location.hash;var reg=/#([^\?&]+)(\?([^\?&=]+=[^\?&=]+)(&([^\?&=]+=[^\?&=]+))*)?/;var result=reg.exec(this._hash);if(result){this._moduleName=result[1];var paramsStr=result[2];if(paramsStr!=null){paramsStr=paramsStr.substr(1);var params=paramsStr.split("&");for(var i=0,len=params.length;i<len;i++){var pair=params[i];if(pair!=null){var temp=pair.split("=");var key=decodeURIComponent(temp[0]);var value=decodeURIComponent(temp[1]);this._params[key]=value}}}this._direct=this._params.direct=="true";delete this._params.direct;this._keepHash=this._params.keepHash=="true";delete this._params.keepHash;if(!this._keepHash)window.location.hash=""}}Object.defineProperty(Hash.prototype,"hash",{get:function(){return this._hash},enumerable:true,configurable:true});Object.defineProperty(Hash.prototype,"moduleName",{get:function(){return this._moduleName},enumerable:true,configurable:true});Object.defineProperty(Hash.prototype,"params",{get:function(){return this._params},enumerable:true,configurable:true});Object.defineProperty(Hash.prototype,"direct",{get:function(){return this._direct},enumerable:true,configurable:true});Object.defineProperty(Hash.prototype,"keepHash",{get:function(){return this._keepHash},enumerable:true,configurable:true});Hash.prototype.getParam=function(key){return this._params[key]};Hash=__decorate([Injector_17.Injectable,__metadata("design:paramtypes",[])],Hash);return Hash}();exports.default=Hash;exports.hash=Core_24.core.getInject(Hash)});define("engine/env/Query",["require","exports","core/Core","core/injector/Injector"],function(require,exports,Core_25,Injector_18){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Query=function(){function Query(){this._params={};var query=window.location.search.substr(1);var vars=query.split("&");for(var i=0,len=vars.length;i<len;i++){var pair=vars[i].split("=",2);if(pair.length!=2||!pair[0])continue;var name=pair[0];var value=pair[1];name=decodeURIComponent(name);value=decodeURIComponent(value);name=decodeURIComponent(name);value=decodeURIComponent(value);this._params[name]=value}}Object.defineProperty(Query.prototype,"params",{get:function(){return this._params},enumerable:true,configurable:true});Query.prototype.getParam=function(key){return this._params[key]};Query=__decorate([Injector_18.Injectable,__metadata("design:paramtypes",[])],Query);return Query}();exports.default=Query;exports.query=Core_25.core.getInject(Query)});define("engine/net/policies/HTTPRequestPolicy",["require","exports","utils/HTTPUtil","engine/env/Environment","engine/net/NetManager","utils/ObjectUtil"],function(require,exports,HTTPUtil_2,Environment_5,NetManager_3,ObjectUtil_8){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var HTTPRequestPolicy=function(){function HTTPRequestPolicy(){}HTTPRequestPolicy.prototype.sendRequest=function(request){var params=request.__params;var httpParams=ObjectUtil_8.extendObject({url:Environment_5.environment.toHostURL(params.path,params.hostIndex),onResponse:function(result){return NetManager_3.netManager.__onResponse(request.__params.response.type,result,request)},onError:function(err){return NetManager_3.netManager.__onError(err,request)},headerDict:{}},params);httpParams.headerDict["withCredentials"]="true";HTTPUtil_2.load(httpParams)};return HTTPRequestPolicy}();exports.HTTPRequestPolicy=HTTPRequestPolicy;exports.default=new HTTPRequestPolicy});define("engine/plugin/IPlugin",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("engine/injector/BindUtil",["require","exports","engine/bind/BindManager"],function(require,exports,BindManager_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function addCompileCommand(target,cmd){var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i]}var bindParams=target.__bind_commands__;if(!bindParams)target.__bind_commands__=bindParams=[];bindParams.push({cmd:cmd,args:args})}exports.addCompileCommand=addCompileCommand;function reverseCompileCommand(target){var bindParams=target.__bind_commands__;bindParams&&bindParams.reverse()}exports.reverseCompileCommand=reverseCompileCommand;function moveCompileCommands(from,to){var commands=from.__bind_commands__;if(!commands)return;if(!to.__bind_commands__)to.__bind_commands__=from.__bind_commands__;else(_a=to.__bind_commands__).push.apply(_a,from.__bind_commands__);from.__bind_commands__=[];var _a}exports.moveCompileCommands=moveCompileCommands;function compile(mediator,target){var bindParams=target.__bind_commands__;if(!bindParams)return;for(var i=0;i<bindParams.length;){var params=bindParams.shift();params.cmd.apply(params,[mediator,target].concat(params.args))}}exports.compile=compile;function compileValue(mediator,target,uiDict){BindManager_2.bindManager.bindValue(mediator,target,uiDict)}exports.compileValue=compileValue;function compileFunc(mediator,target,funcDict){BindManager_2.bindManager.bindFunc(mediator,target,funcDict)}exports.compileFunc=compileFunc;function compileOn(mediator,target,evtDict){BindManager_2.bindManager.bindOn(mediator,target,evtDict)}exports.compileOn=compileOn;function compileIf(mediator,target,uiDict){var bindParams=target.__bind_commands__;var cached=bindParams.splice(0,bindParams.length);var terminated=false;BindManager_2.bindManager.bindIf(mediator,target,uiDict,function(value){if(!terminated&&value){target.__bind_commands__=cached;compile(mediator,target);terminated=true}})}exports.compileIf=compileIf;function compileFor(mediator,target,uiDict){var bindParams=target.__bind_commands__;var cached=bindParams.splice(0,bindParams.length);BindManager_2.bindManager.bindFor(mediator,target,uiDict,function(data,renderer){renderer.__bind_commands__=cached.concat();compile(mediator,renderer)})}exports.compileFor=compileFor;function compileMessage(mediator,target,type,uiDict,observable){BindManager_2.bindManager.bindMessage(mediator,target,type,uiDict,observable)}exports.compileMessage=compileMessage;function compileResponse(mediator,target,type,uiDict,observable){BindManager_2.bindManager.bindResponse(mediator,target,type,uiDict,observable)}exports.compileResponse=compileResponse});define("engine/injector/Injector",["require","exports","core/injector/Injector","core/message/Message","utils/ConstructUtil","engine/net/ResponseData","engine/net/NetManager","engine/bridge/BridgeManager","engine/mediator/Mediator","engine/module/ModuleManager","utils/Dictionary","engine/injector/BindUtil"],function(require,exports,Injector_19,Message_3,ConstructUtil_3,ResponseData_1,NetManager_4,BridgeManager_3,Mediator_3,ModuleManager_3,Dictionary_7,BindUtil){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function ModelClass(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(this===undefined){var cls=ConstructUtil_3.wrapConstruct(args[0]);Injector_19.Injectable.call(this,cls);return cls}else{var result=Injector_19.Injectable.apply(this,args);return function(realCls){realCls=ConstructUtil_3.wrapConstruct(realCls);result.call(this,realCls);return realCls}}}exports.ModelClass=ModelClass;function MediatorClass(cls){if(!cls.prototype.dispose)console.warn("Mediator["+cls["name"]+"]不具有dispose方法，可能会造成内存问题，请让该Mediator实现IDisposable接口");ConstructUtil_3.listenConstruct(cls,function(instance){var $skin;Object.defineProperty(instance,"skin",{configurable:true,enumerable:true,get:function(){return $skin},set:function(value){$skin=value;this.bridge=BridgeManager_3.bridgeManager.getBridgeBySkin(value)}})});return ConstructUtil_3.wrapConstruct(cls)}exports.MediatorClass=MediatorClass;function ModuleClass(cls){if(!cls.prototype.dispose)console.warn("Module["+cls["name"]+"]不具有dispose方法，可能会造成内存问题，请让该Module实现IDisposable接口");var wrapperCls=ConstructUtil_3.wrapConstruct(cls);ModuleManager_3.moduleManager.registerModule(wrapperCls);return wrapperCls}exports.ModuleClass=ModuleClass;function ModuleMessageHandler(target,key){if(key){var defs=Reflect.getMetadata("design:paramtypes",target,key);var resClass=defs[0];if(!(resClass.prototype instanceof Message_3.default))throw new Error("@ModuleMessageHandler装饰器装饰的方法的首个参数必须是Message");doModuleMessageHandler(target.constructor,key,resClass)}else{return function(prototype,propertyKey,descriptor){doModuleMessageHandler(prototype.constructor,propertyKey,target)}}}exports.ModuleMessageHandler=ModuleMessageHandler;function doModuleMessageHandler(cls,key,type){ConstructUtil_3.listenConstruct(cls,function(instance){if(instance instanceof Mediator_3.default){addDelegateHandler(instance,function(){instance.dependModuleInstance.listenModule(type,instance[key],instance)})}else{var module=instance.dependModuleInstance;module&&module.listenModule(type,instance[key],instance)}});ConstructUtil_3.listenDispose(cls,function(instance){var module=instance.dependModuleInstance;module&&module.unlistenModule(type,instance[key],instance)})}function ResponseHandler(target,key){if(key){var defs=Reflect.getMetadata("design:paramtypes",target,key);var resClass=defs[0];if(!(resClass.prototype instanceof ResponseData_1.default))throw new Error("无参数@ResponseHandler装饰器装饰的方法的首个参数必须是ResponseData");doResponseHandler(target.constructor,key,defs[0],false)}else{return function(prototype,propertyKey,descriptor){doResponseHandler(prototype.constructor,propertyKey,target,false)}}}exports.ResponseHandler=ResponseHandler;function ModuleResponseHandler(target,key){if(key){var defs=Reflect.getMetadata("design:paramtypes",target,key);var resClass=defs[0];if(!(resClass.prototype instanceof ResponseData_1.default))throw new Error("无参数@ModuleResponseHandler装饰器装饰的方法的首个参数必须是ResponseData");doResponseHandler(target.constructor,key,defs[0],true)}else{return function(prototype,propertyKey,descriptor){doResponseHandler(prototype.constructor,propertyKey,target,true)}}}exports.ModuleResponseHandler=ModuleResponseHandler;function doResponseHandler(cls,key,type,inModule){ConstructUtil_3.listenConstruct(cls,function(instance){if(instance instanceof Mediator_3.default){addDelegateHandler(instance,function(){NetManager_4.netManager.listenResponse(type,instance[key],instance,false,inModule?instance.observable:undefined)})}else{var module=instance.dependModuleInstance;NetManager_4.netManager.listenResponse(type,instance[key],instance,false,inModule?module.observable:undefined)}});ConstructUtil_3.listenDispose(cls,function(instance){var module=instance.dependModuleInstance;NetManager_4.netManager.unlistenResponse(type,instance[key],instance,false,inModule?module.observable:undefined)})}var delegateHandlerDict=new Dictionary_7.default;function addDelegateHandler(instance,handler){if(!instance)return;var handlers=delegateHandlerDict.get(instance);if(!handlers)delegateHandlerDict.set(instance,handlers=[]);if(handlers.indexOf(handler)<0)handlers.push(handler)}function DelegateMediator(prototype,propertyKey){if(prototype.delegateMediator instanceof Function&&prototype.undelegateMediator instanceof Function){ConstructUtil_3.listenConstruct(prototype.constructor,function(instance){var mediator=instance[propertyKey];if(mediator===undefined){var cls=Reflect.getMetadata("design:type",prototype,propertyKey);instance[propertyKey]=mediator=new cls}mediator["_dependModuleInstance"]=instance;mediator["_dependModule"]=ConstructUtil_3.getConstructor(prototype.constructor);var handlers=delegateHandlerDict.get(mediator);if(handlers){for(var _i=0,handlers_1=handlers;_i<handlers_1.length;_i++){var handler=handlers_1[_i];handler(mediator)}delegateHandlerDict.delete(mediator)}});ConstructUtil_3.listenDispose(prototype.constructor,function(instance){var mediator=instance[propertyKey];if(mediator){mediator["_dependModuleInstance"]=undefined;mediator["_dependModule"]=undefined;instance[propertyKey]=undefined}});var mediator;return{configurable:true,enumerable:true,get:function(){return mediator},set:function(value){if(value==mediator)return;if(mediator){this.undelegateMediator(mediator)}mediator=value;if(mediator){this.delegateMediator(mediator)}}}}}exports.DelegateMediator=DelegateMediator;var onOpenDict=new Dictionary_7.default;function listenOnOpen(prototype,propertyKey,before,after){ConstructUtil_3.listenConstruct(prototype.constructor,function(mediator){var oriFunc=mediator.hasOwnProperty("onOpen")?mediator.onOpen:null;mediator.onOpen=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var target=mediator[propertyKey];var count=onOpenDict.get(target)||0;onOpenDict.set(target,++count);before&&before(mediator);if(oriFunc)mediator.onOpen=oriFunc;else delete mediator.onOpen;mediator.onOpen.apply(this,args);after&&after(mediator);count=onOpenDict.get(target);onOpenDict.set(target,--count);if(count==0){BindUtil.reverseCompileCommand(target);BindUtil.compile(mediator,target);onOpenDict.delete(target)}}})}function BindValue(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var uiDict;if(typeof arg1=="string"){uiDict={};uiDict[arg1]=arg2}else{uiDict=arg1}var target=mediator[propertyKey];BindUtil.addCompileCommand(target,BindUtil.compileValue,uiDict)})}}exports.BindValue=BindValue;function BindFunc(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var funcDict;if(typeof arg1=="string"){funcDict={};funcDict[arg1]=arg2}else{funcDict=arg1}var target=mediator[propertyKey];BindUtil.addCompileCommand(target,BindUtil.compileFunc,funcDict)})}}exports.BindFunc=BindFunc;function BindOn(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var evtDict;if(typeof arg1=="string"){evtDict={};evtDict[arg1]=arg2}else{evtDict=arg1}var target=mediator[propertyKey];BindUtil.addCompileCommand(target,BindUtil.compileOn,evtDict)})}}exports.BindOn=BindOn;function BindIf(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var uiDict;if(typeof arg1=="string"){uiDict={};if(arg2)uiDict[arg1]=arg2;else uiDict["$target"]=arg1}else{uiDict=arg1}var target=mediator[propertyKey];BindUtil.addCompileCommand(target,BindUtil.compileIf,uiDict)})}}exports.BindIf=BindIf;function BindFor(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var uiDict;if(typeof arg1=="string"){uiDict={};if(arg2)uiDict[arg1]=arg2;else uiDict["$target"]=arg1}else{uiDict=arg1}var target=mediator[propertyKey];BindUtil.addCompileCommand(target,BindUtil.compileFor,uiDict)})}}exports.BindFor=BindFor;function BindMessage(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var target=mediator[propertyKey];if(typeof arg1=="string"||arg1 instanceof Function){BindUtil.addCompileCommand(target,BindUtil.compileMessage,arg1,arg2)}else{for(var type in arg1){BindUtil.addCompileCommand(target,BindUtil.compileMessage,type,arg1[type])}}})}}exports.BindMessage=BindMessage;function BindModuleMessage(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var target=mediator[propertyKey];if(typeof arg1=="string"||arg1 instanceof Function){BindUtil.addCompileCommand(target,BindUtil.compileMessage,arg1,arg2,mediator.observable)}else{for(var type in arg1){BindUtil.addCompileCommand(target,BindUtil.compileMessage,type,arg1[type],mediator.observable)}}})}}exports.BindModuleMessage=BindModuleMessage;function BindResponse(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var target=mediator[propertyKey];if(typeof arg1=="string"||arg1 instanceof Function){BindUtil.addCompileCommand(target,BindUtil.compileResponse,arg1,arg2)}else{for(var type in arg1){BindUtil.addCompileCommand(target,BindUtil.compileResponse,type,arg1[type])}}})}}exports.BindResponse=BindResponse;function BindModuleResponse(arg1,arg2){return function(prototype,propertyKey){listenOnOpen(prototype,propertyKey,null,function(mediator){var target=mediator[propertyKey];if(typeof arg1=="string"||arg1 instanceof Function){BindUtil.addCompileCommand(target,BindUtil.compileResponse,arg1,arg2,mediator.observable)}else{for(var type in arg1){BindUtil.addCompileCommand(target,BindUtil.compileResponse,type,arg1[type],mediator.observable)}}})}}exports.BindModuleResponse=BindModuleResponse});define("engine/Engine",["require","exports","core/Core","core/injector/Injector","engine/bridge/BridgeManager","engine/bridge/BridgeMessage","engine/module/ModuleManager","engine/assets/AssetsManager","engine/env/Environment","engine/env/Hash","engine/version/Version","engine/module/ModuleMessage"],function(require,exports,Core_26,Injector_20,BridgeManager_4,BridgeMessage_2,ModuleManager_4,AssetsManager_3,Environment_6,Hash_1,Version_3,ModuleMessage_2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Engine=function(){function Engine(){}Engine.prototype.initialize=function(params){var self=this;if(document.readyState=="loading")document.addEventListener("readystatechange",doInitialize);else doInitialize();function doInitialize(){if(this==document)document.removeEventListener("readystatechange",doInitialize);self._initParams=params;self._loadElement=typeof params.loadElement=="string"?document.querySelector(params.loadElement):params.loadElement;if(params.onError)self.listenError(params.onError);Environment_6.environment.initialize(params.env,params.hostsDict,params.cdnsDict);Version_3.version.initialize(function(){Core_26.core.listen(BridgeMessage_2.default.BRIDGE_ALL_INIT,self.onAllBridgesInit,self);BridgeManager_4.bridgeManager.registerBridge.apply(BridgeManager_4.bridgeManager,params.bridges)})}};Engine.prototype.listenError=function(handler){if(handler)window.addEventListener("error",handler)};Engine.prototype.onAllBridgesInit=function(){Core_26.core.unlisten(BridgeMessage_2.default.BRIDGE_ALL_INIT,this.onAllBridgesInit,this);if(this._initParams.plugins){for(var _i=0,_a=this._initParams.plugins;_i<_a.length;_i++){var plugin=_a[_i];plugin.initPlugin()}}AssetsManager_3.assetsManager.configPath(this._initParams.pathDict);var preloads=this._initParams.preloads;if(preloads){AssetsManager_3.assetsManager.loadAssets(preloads,this.onPreloadOK.bind(this))}else{this.onPreloadOK()}};Engine.prototype.onPreloadOK=function(){this._initParams.onInited&&this._initParams.onInited();Core_26.core.listen(ModuleMessage_2.default.MODULE_CHANGE,this.onModuleChange,this);ModuleManager_4.moduleManager.open(this._initParams.firstModule);if(Hash_1.hash.moduleName)ModuleManager_4.moduleManager.open(Hash_1.hash.moduleName,Hash_1.hash.params,Hash_1.hash.direct)};Engine.prototype.onModuleChange=function(from){Core_26.core.unlisten(ModuleMessage_2.default.MODULE_CHANGE,this.onModuleChange,this);if(this._loadElement){var parent=this._loadElement.parentElement;parent&&parent.removeChild(this._loadElement)}};Engine=__decorate([Injector_20.Injectable],Engine);return Engine}();exports.default=Engine;exports.engine=Core_26.core.getInject(Engine)});define("Olympus",["require","exports","engine/Engine"],function(require,exports,Engine_1){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Olympus=function(){function Olympus(){}Olympus.startup=function(params){Engine_1.engine.initialize(params)};return Olympus}();exports.default=Olympus});